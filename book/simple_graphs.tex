\chapter{Simple Graphs}\label{simple_graphs_chap}

\emph{Simple graphs}%
\index{simple graph} 
model relationships that are \emph{symmetric},%
\index{symmetric relation} 
meaning that the relationship is mutual.
Examples of such mutual relationships are being married, speaking the
same language, not speaking the same language, occurring during
overlapping time intervals, or being connected by a conducting wire.
They come up in all sorts of applications, including scheduling,
constraint satisfaction, computer graphics, and communications, but
we'll start with an application designed to get your attention: we are
going to make a professional inquiry into sexual behavior.  Specifically,
we'll look at some data about who, on average, has more
opposite-gender partners: men or women.

\iffalse
An example is shown in
Figure~\ref{fig:graph-example}.  The dots are called \emph{nodes} (or
\emph{vertices}) and the lines are called \emph{edges}.
\fi

Sexual demographics have been the subject of many studies.  In one of
the largest, researchers from the University of Chicago interviewed a
random sample of 2500 people over several years to try to get an
answer to this question.  Their study, published in 1994 and entitled
\emph{The Social Organization of Sexuality}, found that men have on
average 74\% more opposite-gender partners than women.

Other studies have found that the disparity is even larger.  In
particular, ABC News claimed that the average man has 20 partners over
his lifetime, and the average woman has 6, for a percentage disparity
of 233\%.  The ABC News study, aired on Primetime Live in 2004,
purported to be one of the most scientific ever done, with only a
2.5\% margin of error.  It was called ``American Sex Survey: A peek
between the sheets"---raising some questions about the seriousness of
their reporting.
\begin{editingnotes}
The promotion for the study is even better:
\begin{quote} 
A ground breaking ABC News ``Primetime Live'' survey finds a range of
eye-popping sexual activities, fantasies and attitudes in this country,
confirming some conventional wisdom, exploding some myths----and venturing
where few scientific surveys have gone before.
\end{quote}
Probably that last part about going where few scientific surveys have gone
before is pretty accurate!
\end{editingnotes}

Yet again in August, 2007, the New York Times
\href{http://courses.csail.mit.edu/6.042/spring13/The-Myth-the-Math-the-Sex.pdf}{reported} \iffalse
\href{http://www.nytimes.com/2007/08/12/weekinreview/12kolata.html?_r=1&n=Top/Reference/Times\%20Topics/People/K/Kolata,\%20Gina&oref=slogin}{reported}
\fi on a study by the National Center for Health Statistics of the
U.S. government showing that men had seven partners while women had
four.  So, whose numbers do you think are more accurate: the
University of Chicago, ABC News, or the National Center?

Don't answer---this is a trick question designed to trip you up.
\iffalse like ``When did you stop beating your wife?''\fi Using a
little graph theory, we'll explain why none of these findings can be
anywhere near the truth.

\section{Vertex Adjacency and Degrees}\label{degreessec}

Simple graphs are defined in almost the same way as digraphs, except
that edges are \emph{undirected}---they connect two vertices without
pointing in either direction between the vertices.  So instead of a
directed edge $\diredge{v}{w}$ which starts at vertex $v$ and ends at
vertex $w$, a simple graph only has an undirected edge $\edge{v}{w}$
that connects $v$ and $w$.

\begin{definition}\label{simplegraphdef}
  A \term{simple graph} $G$ consists of a nonempty
  set,~$\vertices{G}$, called the \emph{vertices}%
  \index{vertex!simple graph|textbf} of~$G$, and a set $\edges{G}$
  called the \emph{edges}% \index{edge!simple graph|textbf} of $G$.
  An element of $\vertices{G}$ is called a \emph{vertex}.  An element
  of $\edges{G}$ is an \emph{undirected edge} or simply an ``edge.''
  An undirected edge has two vertices $u\neq v$ called its
  \term{endpoints}.  Such an edge can be represented by the two
  element set $\set{u,v}$.  The notation $\edge{u}{v}$ denotes this
  edge.
\end{definition}
Both $\edge{u}{v}$ and $\edge{v}{u}$ describe the same undirected
edge, whose endpoints are $u$ and $v$.

\begin{figure}[h]
\graphic{graph-example}
\caption{An example of a graph with 9 vertices and 8 edges.}
\label{fig:graph-example}
\end{figure}

For example, let $H$ be the graph pictured in
Figure~\ref{fig:graph-example}.  The vertices of $H$ correspond to the
nine dots in Figure~\ref{fig:graph-example}, that is,
\[
\vertices{H} =  \set{a, b, c, d, e, f, g, h, i}\, .
\]
The edges correspond to the eight lines, that is,
\[
\edges{H} =  \set{\, \edge{a}{b}, \edge{a}{c}, \edge{b}{d}, \edge{c}{d},
              \edge{c}{e}, \edge{e}{f}, \edge{e}{g}, \edge{h}{i} \,}.
\]
Mathematically, that's all there is to the graph $H$.

\begin{definition}
Two vertices in a simple graph are said to be \emph{adjacent} iff they
are the endpoints of the same edge, and an edge is said to be
\emph{incident} to each of its endpoints.  The number of edges
incident to a vertex~$v$ is called the \emph{degree}%
\index{simple graph!degree} 
of the vertex and
is denoted by $\degr{v}$.  Equivalently, the degree of a vertex is the
number of vertices adjacent to it.
\end{definition}

For example, for the graph $H$ of Figure~\ref{fig:graph-example},
vertex~$a$ is adjacent to vertex~$b$, and $b$ is adjacent to~$d$.  The
edge $\edge{a}{c}$ is incident to its endpoints $a$ and~$c$.
Vertex~$h$ has degree~1, $d$ has degree~2, and $\degr{e} = 3$.  It is
possible for a vertex to have degree~0, in which case it is not
adjacent to any other vertices.  A simple graph $G$ does not need to
have any edges at all. $\card{\edges{G}}$ could be zero, implying that
the degree of every vertex would also be zero.  But a simple graph
must have at least one vertex---$\card{\vertices{G}}$ is
required to be at least one.

Note that in a simple graph there cannot be more than one edge between
the same two vertices.\footnote{ \emph{Multigraphs} that have more
  than one edge with the same two endpoints are sometimes convenient,
  but they are not needed for the applications we present.}  Also
\emph{\idx{self-loops}}---edges that begin and at the same vertex---are
  not allowed in simple graphs.\iffalse
\footnote{You might try to represent a self-loop going between a
  vertex $v$ and itself as $\set{v, v}$, but this equals $\set{v}$.
  It wouldn't be an edge, which is defined to be a set of \emph{two}
  vertices.}\fi 

\emph{For the rest of this chapter we'll use ``graphs'' as an abbreviation
  for ``simple graphs.''}

A synonym for ``vertices'' is ``\emph{nodes},'' and we'll use these
words interchangeably.  Simple graphs are sometimes called
\emph{networks}, edges are sometimes called \emph{arcs} or
\emph{lines}.  We mention this as a ``heads up'' in case you look at
other graph theory literature; we won't use these words.

\section{Sexual Demographics in America}\label{sexam}
%A 1994 University of Chicago study entitled \emph{The Social
%Organization of Sexuality} found that on average men have 74\% more
%opposite-gender partners than women.

Let's model the question of heterosexual partners in graph theoretic
terms.  To do this, we'll let $G$ be the graph whose vertices $V$
are all the people in America.  Then we split $V$ into two separate
subsets: $M$ which contains all the males, and $F$ which contains
all the females.\footnote{For simplicity, we'll ignore the possibility
  of someone being \emph{both} a man and a woman, or neither.}  We'll
put an edge between a male and a female iff they have been sexual
partners.  This graph is pictured in Figure~\ref{fig:partners} with
males on the left and females on the right.

\begin{figure}
\graphic{sex-edges}
\caption{The sex partners graph.}
\label{fig:partners}
\end{figure}

Actually, this is a pretty hard graph to figure out, let alone draw.
The graph is \emph{enormous}: the US population is about 300 million,
so $\card{V} \approx 300M$.  Of these, approximately 50.8\% are female
and 49.2\% are male, so $\card{M} \approx 147.6M$, and $\card{F}
\approx 152.4M$.  And we don't even have trustworthy estimates of how
many edges there are, let alone exactly which couples are adjacent.
But it turns out that we don't need to know any of this---we just need
to figure out the relationship between the average number of partners
per male and partners per female.  To do this, we note that every edge
has exactly one endpoint at an $M$ vertex (remember, we're only
considering male-female relationships); so the sum of the degrees of
the $M$ vertices equals the number of edges.  For the same reason, the
sum of the degrees of the $F$ vertices equals the number of edges.  So
these sums are equal:
%
\[
\sum_{x \in M} \degr{x} = \sum_{y \in F} \degr{y}.
\]
%
Now suppose we divide both sides of this equation by the product of the sizes of the
two sets, $\card{M} \cdot \card{F}$:
%
\[
\left(\frac{\sum_{x \in M} \degr{x}}{\card{M}}\right) \cdot \frac{1}{\card{F}} =
\left(\frac{\sum_{y \in F} \degr{y}}{\card{F}}\right) \cdot \frac{1}{\card{M}}
\]
The terms above in parentheses are the \emph{average degree of an $M$
  vertex} and the \emph{average degree of an $F$} vertex.  So we know:
\begin{equation}\label{avgsexMF}
\text{Avg. deg in $M$} = \frac{\card{F}}{\card{M}} \cdot \text{Avg. deg in $F$}
\end{equation}

In other words, we've proved that the average number of female
partners of males in the population compared to the average number of
males per female is \emph{determined solely by the relative number of
  males and females in the population}.

Now the Census Bureau reports that there are slightly more females
than males in America; in particular $\card{F} / \card{M}$ is about
1.035.  So we know that males have on average 3.5\% more
opposite-gender partners than females, and that this tells us nothing about
any sex's promiscuity or selectivity.  Rather, it just has to do with
the relative number of males and females.  Collectively, males and
females have the same number of opposite gender partners, since it
takes one of each set for every partnership, but there are fewer
males, so they have a higher ratio.  This means that the University of
Chicago, ABC, and the Federal government studies are way off.  After a
huge effort, they gave a totally wrong answer.

There's no definite explanation for why such surveys are consistently
wrong.  One hypothesis is that males exaggerate their number of
partners---or maybe females downplay theirs---but these explanations
are speculative.  Interestingly, the principal author of the National
Center for Health Statistics study reported that she knew the results
had to be wrong, but that was the data collected, and her job was to
report it.

The same underlying issue has led to serious misinterpretations of
other survey data.  For example, a couple of years ago, the Boston
Globe ran a story on a survey of the study habits of students on
Boston area campuses.  Their survey showed that on average, minority
students tended to study with non-minority students more than the
other way around.  They went on at great length to explain why this
``remarkable phenomenon'' might be true.  But it's not remarkable at
all.  Using our graph theory formulation, we can see that all it says
is that there are fewer students in a minority than students not in
that minority, which is, of course, what ``minority'' means.

\subsection{Handshaking Lemma} 
The previous argument hinged on the connection between a sum of
degrees and the number of edges.  There is a simple connection between
these in any graph:

\begin{lemma}\label{sumedges}
The sum of the degrees of the vertices in a graph equals twice the
number of edges.
\end{lemma}

\begin{proof}
Every edge contributes two to the sum of the degrees, one for each of its endpoints.
\end{proof}

We refer to Lemma~\ref{sumedges} as the \term{Handshaking Lemma}: if
we total up the number of people each person at a party shakes hands
with, the total will be twice the number of handshakes that occurred.

\begin{problems}

\practiceproblems
 \pinput{TP_handshake_average}
 \pinput{TP_total_degree_20} %uncover after S16 mid3

\classproblems
\pinput{CP_Handshaking_Lemma}

\examproblems
\pinput{CP_bipartite_sex}
\end{problems}

\section{Some Common Graphs}\label{sec:common_graphs}

Some graphs come up so frequently that they have names.  A
\emph{complete graph}%
\index{simple graph!complete graph} 
$K_n$ has $n$ vertices and an edge between
every two vertices, for a total of $n(n-1)/2$ edges.  For example,
$K_5$ is shown in Figure~\ref{fig:K_5}.

\begin{figure}
\graphic{complete-graph}
\caption{$K_5$: the complete graph on five nodes.}
\label{fig:K_5}
\end{figure}

The \emph{empty graph} \index{simple graph!empty graph} has no edges
at all.  For example, the five-vertex empty graph is shown in
Figure~\ref{fig:graph_empty_5}.

\begin{figure}
\graphic{empty-graph}
\caption{An empty graph with five nodes.}
\label{fig:graph_empty_5}
\end{figure}

An $n$-vertex graph containing $n - 1$ edges in sequence is known as

a \emph{line graph}~$L_n$.  More formally, $L_n$ has
\begin{equation*}
    \vertices{L_n} = \set{ v_1, v_2, \dots, v_n }
\end{equation*}
and
\begin{equation*}
    \edges{L_n} = \set{\, \edge{v_1}{v_2}, \edge{v_2}{v_3}, \dots,
    \edge{v_{n-1}}{v_n} \, }
\end{equation*}
For example, $L_5$ is pictured in Figure~\ref{fig:graph_L_5}.

\begin{figure}
\graphic{path-graph}
\caption{$L_5$: a 5-vertex line graph.}
\label{fig:graph_L_5}
\end{figure}

There is also a one-way infinite line graph $L_{\infty}$ which can be
defined by letting the nonnegative integers $\nngint$ be the vertices
with edges $\edge{k}{(k+1)}$ for all $k \in \nngint$.
\begin{editingnotes}
$L_{\infty}$ is pictured in Figure~INSERT%\ref{fig:graph_L_infty}.
\end{editingnotes}

If we add the edge $\edge{v_n}{v_1}$ to the line graph~$L_n$, we get a
graph called a \term{length-$n$ cycle}\index{cycle!of length $n$} \idx{$C_n$}.
Figure~\ref{fig:graph_C_5} shows a picture of length-5 cycle.

\begin{figure}
\graphic{cycle}
\caption{$C_5$: a 5-node cycle graph.}
\label{fig:graph_C_5}
\end{figure}

\section{Isomorphism}\label{isomorphism_sec}
Two graphs that look different might actually be the same in a formal
sense.  For example, the two graphs in
Figure~\ref{fig:isomorphic-C4cross} are both four-vertex, five-edge graphs
and you get graph (b) by a $90^{\text{o}}$ clockwise rotation of graph
(a).
\begin{figure}
\subfloat[]{%
    \graphic{isomorphism_a}
}
\qquad
\subfloat[]{%
    \graphic{isomorphism_b}
}
\caption{Two Isomorphic graphs.}
\label{fig:isomorphic-C4cross}
\end{figure}

Strictly speaking, these graphs are different mathematical objects,
but this difference doesn't reflect the fact that the two graphs can
be described by the same picture---except for the labels on the
vertices.  This idea of having the same picture ``up to relabeling''
can be captured neatly by adapting
Definition~\ref{relation-isomorphism} of isomorphism of digraphs to
handle simple graphs.  An isomorphism between two graphs is an
edge-preserving bijection between their sets of vertices:

\begin{definition}\label{simple-isomorphism}
An isomorphism between graphs $G$ and $H$ is a bijection
$f:\vertices{G} \to \vertices{H}$ such that
\[
\edge{u}{v} \in \edges{G}\ \QIFF\ \edge{f(u)}{f(v)} \in \edges{H}
\]
for all $u, v \in \vertices{G}$.  Two graphs are isomorphic when there
is an isomorphism between them.
\end{definition}

Here is an isomorphism $f$ between the two graphs in
Figure~\ref{fig:isomorphic-C4cross}:
\[
\begin{array}{lll}
f(a) \eqdef 2 & \hspace{0.3in} & f(b) \eqdef 3 \\
f(c) \eqdef 4 & & f(d) \eqdef 1.
\end{array}
\]
You can check that there is an edge between two vertices in the graph
on the left if and only if there is an edge between the two
corresponding vertices in the graph on the right.

Two isomorphic graphs may be drawn very differently.  For example,
Figure~\ref{fig:isomorphic-C5s} shows two different ways of drawing
$C_5$.

\begin{figure}
\graphic{isomorphism-c5}
\caption{Isomorphic~$C_5$ graphs.}
\label{fig:isomorphic-C5s}
\end{figure}

Notice that if $f$ is an isomorphism between $G$ and $H$, then
$f^{-1}$ is an isomorphism between $H$ and $G$.  Isomorphism is also
transitive because the composition of isomorphisms is an isomorphism.
In fact, isomorphism is an equivalence relation.

Isomorphism preserves the connection properties of a graph,
abstracting out what the vertices are called, what they are made out
of, or where they appear in a drawing of the graph.  More precisely, a
property of a graph is said to be \term{preserved under isomorphism}
if whenever $G$ has that property, every graph isomorphic to $G$ also
has that property.  For example, since an isomorphism is a bijection
between sets of vertices, isomorphic graphs must have the same number
of vertices.  What's more, if $f$ is a graph isomorphism that maps a
vertex $v$ of one graph to the vertex $f(v)$ of an isomorphic graph,
then by definition of isomorphism, every vertex adjacent to $v$ in the
first graph will be mapped by $f$ to a vertex adjacent to $f(v)$ in
the isomorphic graph.  Thus, $v$ and $f(v)$ will have the same degree.
If one graph has a vertex of degree four and another does not, then
they can't be isomorphic.  In fact, they can't be isomorphic if the
number of degree-four vertices in each of the graphs is not the same.

Looking for preserved properties can make it easy to determine that two
graphs are not isomorphic, or to guide the search for an
isomorphism when there is one.  It's generally easy in practice to decide
whether two graphs are isomorphic.  However, no one has yet found a
procedure for determining whether two graphs are isomorphic that is
\emph{guaranteed} to run in \idx{polynomial time} on all pairs of
graphs.\footnote{A procedure runs in \emph{polynomial
    time} when it needs an amount of time of at most $p(n)$, where $n$ is
  the total number of vertices and $p()$ is a fixed polynomial.}

Having such a procedure would be useful.  For example, it would make it
easy to search for a particular molecule in a database given the molecular
bonds.  On the other hand, knowing there is no such efficient procedure
would also be valuable: secure protocols for encryption and remote
authentication can be built on the hypothesis that graph isomorphism is
computationally exhausting.

\iffalse
An isomorphism between the two graphs shown in
Figure~\ref{fig:isomorphism} is easy to read off:
\[
\begin{array}{lll}
a \text{ corresponds to } 1 & \hspace{0.5in} & b \text{ corresponds to } 2 \\
d \text{ corresponds to } 4 & & c \text{ corresponds to } 3.
\end{array}
\]

To see why this works, look at any edge in the first graph, say
$\edge{b}{c}$, and make sure that the vertices corresponding to $b$ and
$c$ are the endpoints of an edge in the second graph.  Namely, verify that
$\edge{2}{3}$ is an edge of the second graph; and it is.  Conversely, look
at any edge in the second graph, say $\edge{3}{4}$, and verify that the
corresponding vertices are the endpoints of an edge of the first
graph. Namely, verify that $\edge{c}{d}$ is an edge of the first graph;
and it is.  It's a good practice exercise to verify that every edge in
either of these graphs exactly corresponds in this way to an edge in the
other graph.
\fi

The definitions of bijection and isomorphism apply to infinite graphs
as well as finite graphs, as do most of the results in the rest of
this chapter.  But graph theory focuses mostly on finite graphs, and
we will too.
\begin{quote}
 \emph{In the rest of this chapter we'll assume graphs
  are finite.}
\end{quote}

We've actually been taking isomorphism for granted ever since we wrote
``$K_n$ has $n$ vertices\dots'' at the beginning of
Section~\ref{sec:common_graphs}.  

\iffalse
A pickier sentence is ``Any graph isomorphic to some graph
that is a $K_n$ has $n$ vertices\dots.''  But since having $n$
vertices is a property preserved by isomorphism, the picky version is
unnecessary if not silly.
\fi

\emph{Graph theory is all about properties preserved by isomorphism.}

%% Simple Graphs Problems %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{problems}
\practiceproblems
\pinput{TP_preserved_under_isomorphism}

\classproblems
\pinput{CP_isomorphic_graphs}
\pinput{CP_list_isomorphisms}

\homeworkproblems
\pinput{PS_choose_isomorphic_graphs}
\pinput{PS_neighbors_under_isomorphisms}
\pinput{PS_bogus_graph_two_ends}

%\examproblems

\end{problems}

%\section{Matching Problems}\label{sexam}

\section{Bipartite Graphs \& Matchings}\label{bipartitesec}

%\subsubsection*{Bipartite Graphs}\label{bipartitesubsec}

There were two kinds of vertices in the ``Sex in America'' graph,
males and females, and edges only went between the two kinds.  Graphs
like this come up so frequently that they have earned a special
name: \emph{bipartite graphs}.

\begin{definition}
  A \term{bipartite graph} \index{graph!bipartite} is a graph whose
  vertices can be partitioned into two blocks, $\leftbi{G}$ and
  $\rightbi{G}$, such that every edge has one endpoint in $\leftbi{G}$
  and the other endpoint in $\rightbi{G}$.
\end{definition}

\begin{editingnotes}
So 1-vertex graphs are not bipartite, but all other empty graphs are.
\end{editingnotes}

So every bipartite graph looks something like the graph in
Figure~\ref{fig:partners}.

\subsection{The Bipartite Matching Problem}

The bipartite matching problem is related to the sex-in-America
problem that we just studied; only now, the goal is to get everyone
happily married.  As you might imagine, this is not possible for a
variety of reasons, not the least of which is the fact that there are
more women in America than men.  So, it is simply not possible to
marry every woman to a man so that every man is married at most once.

But what about getting a mate for every man so that every woman is married
at most once?  Is it possible to do this so that each man is paired with a
woman that he likes?  The answer, of course, depends on the bipartite graph
that represents who likes who, but the good news is that it is possible to
find natural properties of the who-likes-who graph that completely
determine the answer to this question.

In general, suppose that we have a set of men and an equal-sized or
larger set of women, and there is a graph with an edge between a man
and a woman if the man likes the woman.  In this scenario, the
``likes'' relationship need not be symmetric, since for the time
being, we will only worry about finding a mate for each man that he
likes.\footnote{It's convenient to describe the matching problem in
  terms of men and women, since it let's us say things like ``a man's
  wife'' instead of ``a left hand node's matching right hand node.''
  We don't think marriage must be heterosexual, or that men should be
  given first choice of mate.}  Later, we will consider the ``likes''
relationship from the female perspective as well.  For example, we
might obtain the graph in Figure~\ref{fig:5J}.

\begin{figure}
\gnote{Tom: We couldn't figure out what was intended here: these edges
  are inconsistent with the text.}
\graphic{hall-graph}
\caption{A graph where an edge between a man and woman denotes that
  the man likes the woman.}
\label{fig:5J}
\end{figure}

A \term{matching} is defined to be an assignment of a woman to each
man so that different men are assigned to different women, and a man
is always assigned a woman that he likes.  For example, one possible
matching for the men is shown in Figure~\ref{fig:5K}.

\begin{figure}
\gnote{Tom: We couldn't figure out what was intended here: these edges
  are inconsistent with the text.  David: Check line widths.}
\graphic{hall-graph-matched}
\caption{One possible matching for the men is shown with bold edges.
  For example, John is matched with Mergatroid.}
\label{fig:5K}
\end{figure}

\subsection{The Matching Condition}\label{match-condition}

A famous result known as \idx{Hall's Matching Theorem} gives necessary
and sufficient conditions for the existence of a matching in a
bipartite graph.  It turns out to be a remarkably useful mathematical
tool.

We'll state and prove Hall's Theorem using man-likes-woman
terminology.  Define \emph{the set of women liked by a given set of
  men} to consist of all women liked by at least one of those men.
For example, the set of women liked by Tom and John in
Figure~\ref{fig:5J} consists of Martha, Sara and Mergatroid.  For us
to have any chance at all of matching up the men, the following
\term{matching condition} must hold:

\medskip

\noindent\text{\emph{The Matching Condition}: every subset of men
  likes at least as large a set of women.}

\medskip

For example, we cannot find a matching if some set of 4~men like only
3~women.  Hall's Theorem says that this necessary condition is
actually sufficient; if the matching condition holds, then a matching
exists.

\begin{theorem}\label{thm:matching}
  A matching for a set~$M$ of men with a set~$W$ of women can be found if
  and only if the matching condition holds.
\end{theorem}

\begin{proof}
  First, let's suppose that a matching exists and show that the matching
  condition holds.  For any subset of men, each man likes at least the
  woman he is matched with and a woman is matched with at most one man.
  Therefore, every subset of men likes at least as large a set of women.
  Thus, the matching condition holds.

Next, let's suppose that the matching condition holds and show that a
matching exists.  We use strong induction on $\card{M}$, the number of
men, on the predicate:
\begin{align*}
    P(m) & \eqdef \text{ if the matching condition holds for a set,~$M$,}\\
         &\qquad  \text{of~$m$ men, then there is a matching for~$M$.}
\end{align*}

\inductioncase{Base case} ($\card{M}=1$): If $\card{M} = 1$, then the
matching condition implies that the lone man likes at least one woman,
and so a matching exists.

\inductioncase{Inductive Step}: \iffalse
We need to show that $\forall k \le m.\, P(k) \QIMPLIES
P(m + 1)$.\fi  Suppose that $\card{M} = m + 1 \ge 2$.  To find a
matching for $M$, there are two cases.
\begin{description}

\item[Case 1:] Every nonempty subset of at most $m$ men likes a
  \emph{strictly larger} set of women.  In this case, we have some
  latitude: we pair an arbitrary man with a woman he likes and send
  them both away.  This leaves $m$ men and one fewer women, and the
  matching condition will still hold.  So the induction hypothesis
  $P(m)$ implies we can match the remaining $m$ men.

\item[Case 2:] Some nonempty subset $X$ of at most $m$ men likes an
  \emph{equal-size} set $Y$ of women.  The matching condition must
  hold within $X$, so the strong induction hypothesis implies we can
  match the men in $X$ with the women in $Y$.  This leaves the problem
  of matching the set $M-X$ of men to the set $W-Y$ of women.

  But the problem of matching $M-X$ against $W-Y$ also satisfies the
  Matching condition, because any subset of men in $M-X$ who liked
  fewer women in $W-Y$ would imply there was a set of men who liked
  fewer women in the whole set $W$.  Namely, if a subset
  $M_0 \subseteq M-X$ liked only a strictly smaller subset of women
  $W_0 \subseteq W-Y$, then the set $M_0 \union X$ of men would like
  only women in the strictly smaller set $W_0 \union Y$.  So again the
  strong induction hypothesis implies we can match the men in $M-X$
  with the women in $W-Y$, which completes a matching for $M$.
  
\iffalse
We can also match the rest of the men by induction if we show that
  the matching condition holds for the remaining men and women.  To
  check the matching condition for the remaining people, consider an
  arbitrary subset of the remaining men $X' \subseteq (M - X)$, and
  let $Y'$ be the set of remaining women that they like.  We must show
  that $\card{X'} \leq \card{Y'}$.  Originally, the combined set of
  men $X \cup X'$ liked the set of women $Y \cup Y'$.  So, by the
  matching condition, we know:
%
  \begin{equation*}
  \card{X \cup X'}  \leq  \card{Y \cup Y'}
  \end{equation*}
%
  We sent away $\card{X}$ men from the set on the left (leaving $X'$)
  and sent away an equal number of women from the set on the right
  (leaving $Y'$).  Therefore, it must be that $\card{X'} \leq
  \card{Y'}$ as claimed.
\fi

\end{description}

So in both cases, there is a matching for the men, which completes the
proof of the Inductive step.  The theorem follows by induction.
\end{proof}

The proof of Theorem~\ref{thm:matching} gives an algorithm for finding
a matching in a bipartite graph, albeit not a very efficient one.
However, efficient algorithms for finding a matching in a bipartite
graph do exist.  Thus, if a problem can be reduced to finding a
matching, instances of the problem can be solved in a reasonably
efficient way.

\subsubsection{A Formal Statement}

Let's restate Theorem~\ref{thm:matching} in mathematical terms so that
you'll not always be condemned to saying, ``Now this group of men
likes at least as many women\dots''

\begin{definition}\label{def:5K}
A \emph{matching} \index{graph!matching} in a graph $G$ is a set of
edges $M \subseteq \edges{G}$ such that no two edges in $M$ are
incident to the same vertex.  The vertices incident to an edge in $M$
are said to be \emph{covered} \index{edge cover}
\index{graph!covering} by $M$.  A matching is said to be
\emph{perfect} \index{perfect graph}\index{graph!perfect} when it
covers $\vertices{G}$.  The set $\neighbors{S}$ of \term{neighbors} of
some set $S \subseteq \vertices{G}$ of vertices is the \idx{image} of
$S$ under the edge-relation, \iffalse set of all vertices adjacent to
some vertex in $S$.  \fi that is,
\[
\neighbors{S} \eqdef \set{\,r \suchthat \edge{s}{r} \in \edges{G} \text{ for
    some } s \in S\,}.
\]
$S$ is called a \term{bottleneck} if
\[
\card{S} > \card{\neighbors{S}}.
\]
\end{definition}

\begin{theorem}[\idx{Hall's Theorem}]\label{thm:halls}
  Let $G$ be a \idx{bipartite graph}.  There is a matching in $G$ that
  covers $\leftbi{G}$ iff no subset of $\leftbi{G}$ is a bottleneck.
\end{theorem}

\subsubsection{An Easy Matching Condition}

The bipartite matching condition requires that \emph{every} subset of
men has a certain property.  In general, verifying that every subset
has some property, even if it's easy to check any particular subset
for the property, quickly becomes overwhelming because the number of
subsets of even relatively small sets is enormous---over a billion
subsets for a set of size 30.  However, there is a simple property of
vertex degrees in a bipartite graph that guarantees the existence of a
matching.  Call a bipartite graph \term*{degree-constrained}
if vertex degrees on the left are at least as large as those on the
right.  More precisely,

\begin{definition}\label{degree-constrained_def}
A bipartite graph $G$ is \index{bipartite
  graph!degree-constrained}\term{degree-constrained} when there is an
integer $d\geq 1$ such that
\begin{equation}\label{lgdgr}
\degr{l} \geq d \geq \degr{r}
\end{equation}
for every $l \in \leftbi{G}$ and $r \in \rightbi{G}$.
\end{definition}

For example, the graph in Figure~\ref{fig:5J} is degree-constrained
with $d=2$, since every vertex on the left is adjacent to at least two
vertices on the right while every vertex on the right is adjacent to
at most two vertices on the left.

\begin{theorem}\label{lem:no_bottleneck_degree_constrained}
  If $G$ is a degree-constrained bipartite graph, then there is a matching
  that covers~$\leftbi{G}$.
\end{theorem}

\begin{proof}
Suppose $G$ satisfies~\eqref{lgdgr}, and let $S$ be a subset of
$\leftbi{G}$.  We will show that $S$ satisfies Hall's condition,
namely,
\begin{equation}\label{not_bottleneck_ineq}
  \card{\neighbors{S}} \geq \card{S}.
\end{equation}

Let $D_S$ be the set of edges with an endpoint in a $S$.  According
to~\eqref{lgdgr}, every vertex in~$S$ is the endpoint of at least $d$
edges,
\[
\card{D_S} \geq d\card{S}.
\]
Likewise, any edge in $D_S$ has an endpoint in $\neighbors{S}$ by
definition.  According to~\eqref{lgdgr}, every vertex in
$\neighbors{S}$ is incident to at most $d$ edges, so we also have
\[
d\card{\neighbors{S}} \geq \card{D_S}.
\]
Combining the above inequalities gives
\[
d\card{\neighbors{S}} \ge d\card{S}.
\]
Now cancelling $d$ completes the derivation of
equation~\eqref{not_bottleneck_ineq}.
\end{proof}

A graph is \term{regular} when all its vertice have the same degree.
Regular graphs come up in lots of examples.  Since a nonempty
bipartite regular graph is degree-constrained by definition,
Theorem~\ref{lem:no_bottleneck_degree_constrained} guarantees it will
have a perfect matching.

\iffalse
\begin{definition}\label{def:5P}
A graph is said to be \emph{regular} if every vertex has the same degree.
\end{definition}

\begin{theorem}\label{thm:5M}
Every regular bipartite graph has a perfect matching.
\end{theorem}

\begin{proof}
  Let $G$ be a regular bipartite graph.  Since regular graphs are
  degree-constrained, we know by
  Theorem~\ref{lem:no_bottleneck_degree_constrained} that there must
  be a matching in~$G$ that covers~$\leftbi{G}$.  Such a matching is
  only possible when $\card{\leftbi{G}} \leq \card{\rightbi{G}}$.  But
  $G$ is also degree-constrained if the roles of $\leftbi{G}$ and
  $\rightbi{G}$ are switched, which implies that $\card{\rightbi{G}}
  \leq \card{\leftbi{G}}$ also.  That is, $\leftbi{G}$ and
  $\rightbi{G}$ are the same size, and any matching covering
  $\leftbi{G}$ will also cover $\rightbi{G}$.  So every vertex in~$G$ is
  an endpoint of an edge in the matching, and thus $G$ has a perfect
  matching.
\end{proof}
\fi

%% Bipartite Matchings Problems %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problems}
\practiceproblems
\pinput{TP_bipartite_degrees}

\classproblems
\pinput{CP_student_clubs}
\pinput{CP_degree_constrained_induction}

\examproblems
\pinput{FP_bipartite_matching_recitations}
\pinput{MQ_degree_constrained}
\pinput{FP_propositional_formulas_matching}
\pinput{FP_matching}

\homeworkproblems
\pinput{CP_latin_squares}
\pinput{PS_cards_in_4_rows_13_columns}
\pinput{PS_bipartite_matching_virtues}
\pinput{PS_tournament_matching_problem}
\end{problems}

\section{Coloring}\label{sec:coloring}

In Section~\ref{sexam}, we used edges to indicate an affinity between a
pair of nodes.  But there are lots of situations in which edges will
correspond to \emph{conflicts} between nodes.  Exam scheduling is a
typical example.

\subsection{An Exam Scheduling Problem}

Each term, the MIT Schedules Office must assign a time slot for each
final exam.  This is not easy, because some students are taking
several classes with finals, and (even at MIT) a student can take only
one test during a particular time slot.  The Schedules Office wants to
avoid all conflicts.  Of course, you can make such a schedule by
having every exam in a different slot, but then you would need
hundreds of slots for the hundreds of courses, and the exam period
would run all year!  So, the Schedules Office would also like to keep
exam period short.

The Schedules Office's problem is easy to describe as a graph.  There
will be a vertex for each course with a final exam, and two vertices
will be adjacent exactly when some student is taking both courses.
For example, suppose we need to schedule exams for 6.041, 6.042,
6.002, 6.003 and 6.170.  The scheduling graph might appear as in
Figure~\ref{fig:5R}.

\begin{figure}
\graphic{finals-subject-labels}
\caption{A scheduling graph for five exams.  Exams connected by an
  edge cannot be given at the same time.}
\label{fig:5R}
\end{figure}

6.002 and 6.042 cannot have an exam at the same time since there are
students in both courses, so there is an edge between their nodes.  On the
other hand, 6.042 and 6.170 can have an exam at the same time if they're
taught at the same time (which they sometimes are), since no student can
be enrolled in both (that is, no student \emph{should} be enrolled in both
when they have a timing conflict).

We next identify each time slot with a color.  For example, Monday
morning is red, Monday afternoon is blue, Tuesday morning is green,
etc.  Assigning an exam to a time slot is then equivalent to coloring
the corresponding vertex.  The main constraint is that \emph{adjacent
  vertices must get different colors}---otherwise, some student has
two exams at the same time.  Furthermore, in order to keep the exam
period short, we should try to color all the vertices using as
\emph{few different colors as possible}.  As shown in Figure~\ref{fig:5S},
three colors suffice for our example.

\begin{figure}
\graphic{finals-subject-colored}
\caption{A 3-coloring of the exam graph from Figure~\ref{fig:5R}.}
\label{fig:5S}
\end{figure}

The coloring in Figure~\ref{fig:5S} corresponds to giving one final on
Monday morning (red), two Monday afternoon (blue), and two Tuesday
morning (green).  Can we use fewer than three colors?  No! We can't
use only two colors since there is a triangle in the graph, and three
vertices in a triangle must all have different colors.

This is an example of a \term{graph coloring} problem:
\index{graph!coloring problem} given a graph $G$, assign colors to each
node such that adjacent nodes have different colors.  A color assignment
with this property is called a \term{valid coloring} \index{graph!valid
  coloring} of the graph---a ``\term{coloring},'' for short.  A graph $G$
is $k$-\term{colorable} if it has a coloring that uses at most $k$ colors.
\begin{definition}
  The minimum number of colors for which a graph $G$ has a valid coloring is
  called its \term{chromatic number}, \term{$\chi(G)$}.
\end{definition}
So $G$ is $k$-colorable iff $\chi(G) \leq k$.

\subsection{Some Coloring Bounds}

There are some simple properties of graphs that give useful bounds on
colorability. 

The simplest property is being a \idx{cycle}: an even-length
cycle is 2-colorable.  So
\[
\chi(C_{\text{even}}) = 2.
\]
On the other hand, an odd-length cycle requires 3 colors, that is,
\begin{equation}\label{Codd3}
\chi(C_{\text{odd}}) = 3.
\end{equation}
You should take a moment to think about why this equality holds.

\begin{editingnotes}
\textcolor{red}{FTL proof yanked from
  Theorem~\ref{thm:2-colorable-equiv}}

Let $G$ be a 2-colorable graph and
\begin{equation*}
    \walkv{w} \eqdef v_0, v_1, \dots, v_k
\end{equation*}
be any closed walk in~$G$.  So in any 2-coloring of~$G$, consecutive
vertices $v_i$ and $v_{i + 1}$ must be colored differently since
$\edge{v_i}{v_{i + 1}} \in \edges{G}$.
Hence $v_0$, $v_2$, $v_4$, \dots, have one color and $v_1$, $v_3$,
$v_5$, \dots, have the other color.  Since $\walkv{w}$ is a closed
walk, $v_k$ is the same node as~$v_0$, and so $k$ must be an even
number.  This means that $\walkv{w}$ has even length.
\end{editingnotes}
Another simple example is a complete graph $K_n$:
\[
\chi(K_n) = n
\]
since no two vertices can have the same color.

Being bipartite is another property closely related to colorability.
If a graph is bipartite, then you can color it with 2 colors using one
color for the nodes on the ``left'' and a second color for the nodes
on the ``right.''  Conversely, graphs with chromatic number 2 are all
bipartite with all the vertices of one color on the ``left'' and those
with the other color on the right.  Since only graphs with no
edges---the \emph{\idx{empty graph}s}---have chromatic number 1, we
have: \iffalse Empty graphs are bipartite as long they have at least
two vertices: a graph with only one vertex is not bipartite because
its vertex set cannot be partitioned into two \emph{nonempty}
subsets.\fi
\begin{lemma}\label{2color-iff-bip}
A nonempty graph $G$ is bipartite iff $\chi(G) = 2$.
\end{lemma}

The chromatic number of a graph can also be shown to be small if the
vertex degrees of the graph are small.  In particular, if we have an
upper bound on the degrees of all the vertices in a graph, then we can
easily find a coloring with only one more color than the degree bound.

\begin{theorem}\label{thm:n+1-colorable}
A graph with maximum degree at most $n$ is $(n+1)$-colorable.
\end{theorem}

Now you might be tempted to try to prove this theorem using induction
on~$n$, but this would be a poor choice---we actually don't know any
way to this work, so we expect it would ruin your week if this was
your approach on a problem set.  On the other hand, the number of
vertices or the number of edges are typically good quantities on which
to base induction proofs about graphs.  We will prove
Theorem~\ref{thm:n+1-colorable} by induction on the number of
vertices.

\begin{proof}[Proof of Theorem~\ref{thm:n+1-colorable}]
Let $n \in \nngint$ be fixed.  The induction hypothesis will be:
\[
P(k) \eqdef \text{If a $k$-vertex graph has maximum degree $n$, then
  it is $(n+1)$-colorable}.
\].
\inductioncase{Base case} ($k=1$): A 1-vertex graph has maximum degree
0 and is 1-colorable, so $P(1)$ is true.

\inductioncase{Inductive step}: Now assume that $P(k)$ is true, and
let $G$ be an $(k+1)$-vertex graph with maximum degree at most $n$.
Remove a vertex $v$ and all edges incident to $v$ from $G$, leaving a
$k$-vertex subgraph $H$.  The maximum degree of $H$ is still at most
$n$, and so we can find an $(n+1)$-coloring for $H$ by induction
hypothesis.

Now add back vertex $v$.  Since there are more colors---$n+1$---than
vertices adjacent to~$v$---at most $\degr{v}\leq n$---we can now pick
a color for $v$ that is different from the colors of all these
adjacent vertices.  This yields a coloring of $G$ with $(n+1)$-colors.
So we have shown that $G$ is $(n+1)$-colorable, as required.
\end{proof}

Sometimes $n+1$ colors is the best you can do.  For example, every
node in $K_{n+1}$ has degree $n$ and $\chi(K_{n+1}) = n+1$, so this is
an example where Theorem~\ref{thm:n+1-colorable} gives the best
possible bound.  Theorem~\ref{thm:n+1-colorable} also gives the best
possible coloring bound for \emph{any} graph with degree bounded by
$n$ that has $K_{n+1}$ as a subgraph.

But sometimes $n+1$ colors are far from the best that you can do.  For
example, the \term{star graph} shown in Figure~\ref{fig:5T} has
maximum degree six but can be colored using just two colors.

\begin{figure}
\graphic{star-graph}
\caption{A seven-vertex star graph.}
\label{fig:5T}
\end{figure}

In general it is very hard to find a minimal coloring for an arbitrary
graph.  In fact, just calculating the chromatic number is hard.  We'll
say more about this in the next section.

\subsection{Why coloring?}

One reason coloring problems frequently arise in practice is because
scheduling conflicts are so common.  For example, at the internet
company \href{www.akamai.com}{Akamai}, cofounded by Tom Leighton, a
new version of software is deployed over each of its servers (200,000
servers in 2016) every few days.  It would take more than twenty years
to update all these the servers one at a time, so the deployment must
be carried out for many servers simultaneouly.  On the other hand,
certain pairs of servers with common critical functions cannot be
updated simultaneouly, since a server needs to be taken offline while
being updated.

This problem gets solved by making a 200,000-node conflict graph and
coloring it with with a dozen or so colors---so only a dozen or so
waves of installs are needed!

Another example comes from the need to assign frequencies to radio
stations.  If two stations have an overlap in their broadcast area,
they can't be given the same frequency.  Frequencies are precious and
expensive, so it is important to minimize the number handed out.  This
amounts to finding the minimum coloring for a graph whose vertices are
the stations and whose edges connect stations with overlapping areas.

Coloring also comes up in allocating registers for program variables.
While a variable is in use, its value needs to be saved in a register.
Registers can be reused for different variables, but two variables
need different registers if they are referenced during overlapping
intervals of program execution.  So register allocation is the
coloring problem for a graph whose vertices are the variables:
vertices are adjacent if their intervals overlap, and the colors are
registers.  Once again, the goal is to minimize the number of colors
needed to color the graph.

Finally, there's the famous map coloring problem stated in
Proposition~\ref{4colorprop}.  How many colors are needed to color a
map so that adjacent territories get different colors?  Answering the
question has no direct practical applications, but it tantalized graph
theorists for over a century until an answer was discovered---to great
acclaim---in the 1970's: four colors are enough to color any map.  A
reasonably efficient way to find an actual 4-coloring can be based on
that proof.

Surprisingly, the question whether there is an efficient procedure to
tell if an arbitrary planar graph really \emph{needs} four colors---or
if three would do the job---turns out to be the SAT problem of
Section~\ref{SAT_sec} in disguise.  So you win a million dollars if
you figure out how hard it is to determine 3-colorability.  A proof
that testing 3-colorability of planar graphs is as hard as SAT is
given in Problems~\ref{PS_3color_SAT}
and~\ref{PS_3color_crossover}.

\iffalse
Planarity is another property with important colorability consequences.
The famous 4-Color Theorem says that every planar graph is 4-colorable.
This is a hard result to prove, but we will come close in
Chapter~\ref{planar_graphs_chap} where we define planar graphs and prove
that they are 5-colorable.
\fi

\begin{problems}
%\practiceproblems

\classproblems
\pinput{CP_chromatic_number}
\pinput{CP_register_allocation}
\pinput{CP_bipartite_coloring}

\homeworkproblems
\pinput{PS_TA_recitation_graph_coloring}
\pinput{PS_graph_colorable}
\pinput{PS_graph_width}
\pinput{PS_coloring_induction}
\pinput{PS_coloring_no_triangles}
\pinput{PS_3color_SAT}
\pinput{PS_3color_crossover}

\examproblems
\pinput{FP_bogus_coloring_proof}
\pinput{MQ_3color_XOR}

\end{problems}


%% Connectedness %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Walks in Simple Graphs}\label{sec:connectedness}

\subsection{Walks, Paths, Cycles}
Walks and paths in simple graphs are esentially the same as in
digraphs.  We just modify the digraph definitions using undirected
edges instead of directed ones.  For example, the formal definition of
a walk in a simple graph is a virtually the same as the
Definition~\ref{def:digraph-walks} of a walk in a digraph:

\begin{definition}\label{def:simplegraph-walks}
A \term{walk in a simple graph} $G$ is an alternating sequence of
vertices and edges that begins with a vertex, ends with a vertex, and
such that for every edge $\edge{u}{v}$ in the walk, one of the
endpoints $u$, $v$ is the element just before the edge, and the other
endpoint is the next element after the edge.  The \term{length of a
  walk} is the total number of occurrences of edges in it.

So a walk $\walkv{v}$ is a sequence of the form
\[
\walkv{v} \eqdef v_0\ \edge{v_0}{v_1}\
v_1\  \edge{v_1}{v_2}\  v_2\  \dots\  \edge{v_{k-1}}{v_k}\  v_k
\]
where $\edge{v_i}{v_{i+1}} \in \edges{G}$ for $i \in \Zintvco{0}{k}$.
  The walk is said to \emph{start} at $v_0$, to \emph{end} at $v_k$,
  and the \emph{length}, $\lnth{\walkv{v}}$, of the walk is
  $k$.  The walk is a \emph{path} iff all the $v_i$'s are different,
  that is, if $i \neq j$, then $v_i \neq v_j$.

A walk that begins and ends at the same vertex is a \term{closed
  walk}.  A single vertex counts as a length zero closed walk as well
as a length zero path.

A \term{cycle} can be represented by a closed walk of length three or
more whose vertices are distinct except for the beginning and end
vertices.
\end{definition}
Note that in contrast to digraphs, we don't count length two closed
walks as cycles in simple graphs.  That's because a walk going back
and forth on the same edge is neither interesting nor important.
There are also no closed walks of length one, since simple graphs
don't have self-loops.

As in digraphs, the length of a walk is the number of occurrences of
\emph{edges} in the walk, which is \emph{one less} than the number of
occurrences of vertices.  For example, the graph in
Figure~\ref{dg} has a length~6 path through the seven successive
vertices $abcdefg$.  This is the longest path in the graph.
\begin{figure}
\graphic{distance-graph}
\caption{\em A graph with 3 cycles: $bhecb$,
$cdec$, $bcdehb$.}
\label{dg}
\end{figure}
The graph in Figure~\ref{dg} also has three cycles through successive
vertices $bhecb$, $cdec$ and $bcdehb$.

\subsection{Cycles as Subgraphs}

We don't intend that cycles have a beginning or an end, so \emph{any}
of the paths that go around a cycle can represent it.  For example, in
the graph in Figure~\ref{dg}, the cycle starting at $b$ and going
through vertices $bcdehb$ can also be described as starting at $d$ and
going through $dehbcd$.  Furthermore, cycles in simple graphs don't
have a direction: $dcbhed$ describes the same cycle as though it
started and ended at $d$ but went in the opposite direction.

A precise way to explain which closed walks represent the same cycle
is to define a cycle to be \emph{subgraph} isomorphic to a cycle graph
$C_n$.

\begin{definition}\label{def:subgraph}
  A graph $G$ is said to be a \emph{subgraph} of a graph $H$ if
  $\vertices{G} \subseteq \vertices{H}$ and $\edges{G} \subseteq
  \edges{H}$.
\end{definition}

For example, the one-edge graph $G$ where
\begin{equation*}
   \vertices{G} = \set{ g, h, i } \quad \text{and}\quad  \edges{G} =
   \set{\, \edge{h}{i} \, }
\end{equation*}
is a subgraph of the graph $H$ in Figure~\ref{fig:graph-example}.  On the
other hand, any graph containing an edge~$\edge{g}{h}$ will not be a
subgraph of $H$ because this edge is not in $\edges{H}$.  Another example
is an empty graph on $n$ nodes, which will be a subgraph of an~$L_n$ with
the same set of vertices; similarly, $L_n$ is a subgraph of ~$C_n$, and ~$C_n$ is
a subgraph of~$K_n$.

\begin{definition}
  For $n \ge 3$, let \term{$C_n$} be the graph with vertices
  $\Zintvco{0}{n}$ and edges
\[
\edge{0}{1},\ \edge{1}{2},\ \dots,\  \edge{(n-2)}{n-1},\ \edge{n-1}{0}.
\]

\iffalse
A graph is a \term{cycle} of length $n$ iff it is isomorphic to $C_n$
for some $n \ge 3$.
\fi

A \term{cycle of a graph} $G$ is a subgraph of $G$ that is
isomorphic to $C_n$ for some $n \ge 3$.
\end{definition}

This definition formally captures the idea that cycles don't
have direction or beginnings or ends.

\begin{problems}
\examproblems
\pinput{FP_odd_length_walk_simple}

\homeworkproblems
\pinput{PS_shortest_undirected_closed_walk}
\end{problems}

\section{Connectivity}\label{connect-sec}

\begin{definition}\label{def:connected-vertices} %\label{def:connected-graph}
  \emph{Two vertices are} \term{connected} in a graph when there is a
  path that begins at one and ends at the other.  By convention, every
  vertex is connected to itself by a path of length zero.  A
  \emph{graph is connected} when every pair of vertices are connected.
\end{definition}

\subsection{Connected Components}

Being connected is usually a good property for a graph to have.  For
example, it could mean that it is possible to get from any node to any
other node, or that it is possible to communicate between any pair of
nodes, depending on the application.

But not all graphs are connected.  For example, the graph where nodes
represent cities and edges represent highways might be connected for
North American cities, but would surely not be connected if you also
included cities in Australia.  The same is true for communication
networks like the internet---in order to be protected from viruses
that spread on the internet, some government networks are completely
isolated from the internet.

\begin{figure}[htbp]
\graphic{connectivity-graphs}
\caption{One graph with 3 connected components.}
\label{fig:3comp}
\end{figure}

Another example is shown in Figure~\ref{fig:3comp}, which looks like a
picture of three graphs, but is intended to be a picture of \emph{one}
graph.  This graph consists of three pieces.  Each piece is a subgraph
that by itself is connected, but there are no paths between vertices
in different pieces.  These connected pieces of a graph are called its
\term{connected components}.

\begin{definition}\label{def:connected-component}
A \emph{connected component} of a graph is a subgraph consisting of
some vertex and every node and edge that is connected to that vertex.
\end{definition}

So a graph is connected iff it has exactly one connected component.
At the other extreme, the empty graph on $n$ vertices has $n$
connected components, each consisting of a single vertex.

\subsection{Odd Cycles and 2-Colorability}\label{subsec:odd_cycles}

We have already seen that determining the chromatic number of a graph is a
challenging problem.  There is one special case where this problem is very
easy, namely, when the graph is 2-colorable.

\begin{theorem}\label{thm:2-colorable-equiv}
The following graph properties are equivalent:

\begin{enumerate}

\item\label{has-odd-cycle}
The graph contains an odd length cycle.

\item\label{not-2-color}
The graph is not 2-colorable.

\item\label{has-odd-closed-walk}
The graph contains an odd length closed walk.

\end{enumerate}
\end{theorem}
In other words, if a graph has any one of the three properties above,
then it has all of the properties.

We will show the following implications among these properties:
\[
\text{\ref{has-odd-cycle}.} \QIMPLIES \text{\ref{not-2-color}.} \QIMPLIES
\text{\ref{has-odd-closed-walk}.} \QIMPLIES
\text{\ref{has-odd-cycle}}.
\]
So each of these properties implies the other two, which means they
all are equivalent.
\iffalse
\footnote{Mutual implication follows from transivity of implication,
  Rule~\ref{rule:transitivity} in Section~\ref{sec:logical_deduction}}
\fi

\begin{description}

\item[\ref{has-odd-cycle}.\ \QIMPLIES\ \ref{not-2-color}.]
\begin{proof}
This follows from equation~\ref{Codd3}.
\end{proof}

\item[\ref{not-2-color}. \QIMPLIES\ \ref{has-odd-closed-walk}.]

  If we prove this implication for connected graphs, then it will hold
  for an arbitrary graph because it will hold for each
  connected component.  So we can assume that $G$ is connected.
\begin{proof}

  Pick an arbitrary vertex $r$ of $G$.  Since $G$ is connected, for every
  node $u \in \vertices{G}$, there will be a walk $\walkv{w}_u$ starting
  at $u$ and ending at $r$.  Assign colors to vertices of $G$ as follows:
\[
\text{color}(u) = \begin{cases}
                   \text{black}, & \text{if $\lnth{\walkv{w}_u}$ is even},\\
                   \text{white}, & \text{otherwise}.
\end{cases}
\]
Now since $G$ is not colorable, this can't be a valid coloring.  So there
must be an edge between two nodes $u$ and $v$ with the same color.  But in
that case
\[
%\catv{\catv{\walkv{w}_u}{r}{\text{reverse}(\walkv{w}_v)}}{v}{vu}
%\merge{\catv{\walkv{w}_u}{r}{\text{reverse}(\walkv{w}_v)}}{\edge{v}{u}}
\merge{\merge{\walkv{w}_u}{\text{reverse}(\walkv{w}_v)}}{\edge{v}{u}}
\]
is a closed walk starting and ending at $u$, and its length is
\[
\lnth{\walkv{w}_u} + \lnth{\walkv{w}_v} + 1
\]
which is odd.
\end{proof}

\item[\ref{has-odd-closed-walk}.\ \QIMPLIES\ \ref{has-odd-cycle}.]

\begin{proof}
  Since there is an odd length closed walk, the WOP implies there is an odd
  length closed walk $\walkv{w}$ of minimum length.  We claim $\walkv{w}$
  must be a cycle.  To show this, assume to the contrary that
  $\walkv{w}$ is not a cycle, so there is a repeat vertex occurrence
  besides the start and end.   There are then two cases to consider depending on
whether the additional repeat is different from, or the same as, the
start vertex.

In the first case, the start vertex has an extra occurrence.  That is,
\[
\walkv{w} = \catv{\walkv{f}}{x}{\walkv{r}}
\]
for some positive length walks $\walkv{f}$ and $\walkv{r}$ that begin and
end at $x$.  Since
\[
\lnth{\walkv{w}} =  \lnth{\walkv{f}}+ \lnth{\walkv{r}}
\]
is odd, exactly one of $\walkv{f}$ and $\walkv{r}$ must have odd length,
and that one will be an odd length closed walk shorter than $\walkv{w}$, a
contradiction.

In the second case,
\[
\walkv{w} = \catv{\catv{\walkv{f}}{y}{\walkv{g}}}{y}{\walkv{r}}
\]
where $\walkv{f}$ is a walk from $x$ to $y$ for some $y \neq x$, and
$\walkv{r}$ is a walk from $y$ to $x$, and $\lnth{\walkv{g}} > 0$.
Now $\walkv{g}$ cannot have odd length or it would be an odd-length
closed walk shorter than $\walkv{w}$.  So $\walkv{g}$ has even length.
That implies that $\catv{\walkv{f}}{y}{\walkv{r}}$ must be an
odd-length closed walk shorter than $\walkv{w}$, again a
contradiction.

This completes the proof of Theorem~\ref{thm:2-colorable-equiv}.
\end{proof}
\end{description}


\begin{editingnotes}

\textcolor{red}{Here's cleaned up version of FTL's direct proof
  that~\ref{not-2-color} implies~\ref{has-odd-cycle}.  It's here for
  the record, but really should be put in a problem (if it's used at
  all).}

But we're going to present an interesting direct proof that

\ref{not-2-color} $\QIMPLIES$~\ref{has-odd-cycle}

based on the triangle inequality, Lemma~\ref{lem:tri-ineq}.

\begin{proof}
If we prove this implication for connected graphs, then it will hold
for an arbitrary graph because it will hold for each connected
component.  So we can assume that $G$ is connected.

Pick an arbitrary vertex $r$ of $G$ and assign colors to vertices as
follows:
\begin{equation}\label{colorurule}
\text{color}(u) \eqdef
             \begin{cases}
                   \text{black}, & \text{if $\dstuv{u}{r}$ is even},\\
                   \text{white}, & \text{otherwise}.
             \end{cases}
\end{equation}
Since $G$ is not supposed to be 2-colorable, this can't be a valid
coloring, that is, there must be an edge $\edge{u}{v}$ between two nodes
with the same color.

Because of the edge $\edge{u}{v}$, the distance between $u$ and $v$ is
1.  Because $G$ is connected, $\dstuv{u}{r}$ and $\dstuv{v}{r}$ are
both finite.  Therefore, the distance from $u$ to $r$ differs by at
most 1 from the distance from $v$ to $r$, by the triangle inequality.
But $u$ and $v$ have the same color, so their distances to $r$ can
only differ by an even number.  Of course, 0 is the only nonnegative
integer that both most 1 and even.  So they can't differ at all:
\begin{equation}\label{dstur=vr}
\dstuv{u}{r} = \dstuv{v}{r}.
\end{equation}

Here's how we find the odd cycle: given any path from $u$ to $r$ and
any path from $v$ to $r$, the vertex $r$ will be on both, by
definition,.  So by WOP, given any shortest path from $u$ to $r$ and
any shortest path from $v$ to $r$, there is a vertex $x$ on both paths
whose distance to $u$ is a minimum.  Now a shortest path from $u$ to
$x$ and a shortest path from $v$ to $x$ can \emph{only} have vertex
$x$ in common, since any other vertex they had in common would be
closer to $u$ than $x$ was.  Therefore, a shortest path from $u$ to
$x$ together with a shortest path from $v$ to $x$ and the edge
$\edge{u}{v}$ form a cycle of length
\begin{equation}\label{uxvx1}
\dstuv{u}{x}+  \dstuv{v}{x} +1.
\end{equation}

But since $x$ is on these shortest paths, Lemma~\ref{lem:tri-ineq} implies
\begin{align*}
\dstuv{u}{r} & = \dstuv{u}{x} + \dstuv{x}{r}\\
\dstuv{v}{r} & = \dstuv{v}{x} + \dstuv{x}{r},
\end{align*}
and these equalities together with equation~\eqref{dstur=vr},
imply
\[
\dstuv{v}{x} = \dstuv{u}{x}.
\]
So the cycle length~\ref{uxvx1} equals the odd number $2\dstuv{u}{x}+1$.
\end{proof}
\end{editingnotes}

\iffalse
Theorem~\ref{thm:2-colorable-equiv} turns out to be useful, since
bipartite graphs come up fairly often in practice.\footnote{One
  example concerning routing networks already came up in
  Lemma~\ref{deg1-union}.  Corollary~\ref{cor:K33-nonplanar} reveals
  the importance of another example in planar graph theory.}
\fi

%\begin{editingnotes}
\section{Special Walks and Tours}

\subsection{Euler Tours}
 Can you walk every hallway in the Museum of Fine Arts \emph{exactly
   once}?  If we represent hallways with vertices and connections
 between hallways with edges, then this reduces to a question about
 graphs.  For example, could you visit every hallway exactly once in a
 museum with floor plan represented by the graph in
 Figure~\ref{fig:5BC}?

\begin{editingnotes}
Use a ``real'' floor-plan.
\end{editingnotes}

\begin{figure}
\graphic{euler-tour}
\caption{Is there a walk that includes every edge exactly once?}
\label{fig:5BC}
\end{figure}

The entire field of graph theory began when the famous 17th century
mathematician Leonhard Euler\footnote{Same Euler who defined the
  constant $e\approx 2.718$ and the totient function $\phi$---he did a
  lot of stuff.} asked whether the seven bridges of K\"onigsberg could
all be crossed exactly once---essentially the same question we asked
about the Museum of Fine Arts.

An \term{Euler tour}\footnote{In some other texts, Euler ``tours'' are
  called Euler ``circuits.''} of a graph is a closed walk that
includes every edge exactly once.  Graphs with Euler tours turn out to
be easy to recognize:

\begin{theorem}\label{thm:euler-tour}
A connected graph has an Euler tour if and only if every vertex has
even degree.
\end{theorem}

The proof is worked out in a series of easy steps in
Problem~\ref{PS_Euler_circuits}.  Implicit in the proof is a simple
way to find Euler tours when they exist, namely, grow a tour by
repeatedly splicing in closed walks until all the edges are included.

Similarly, there is a walk that includes every edge exactly once but
is \emph{not} a tour---it begins and ends at different verticies---if
and only if there are exactly two vertices of odd degree.  The graph
shown in Figure~\ref{fig:5BC} has exactly two vertices with odd
degree, so it has a such a walk but not an Euler tour.

\subsection{Hamiltonian Cycles}

Hamiltonian cycles are the unruly cousins of Euler tours.

\begin{definition}\label{def:hamiltonian-cycle}
A \emph{Hamiltonian cycle} in a graph~$G$ is a cycle that visits every
\emph{vertex} in~$G$ exactly once.  Similarly, a \emph{Hamiltonian}
path is a path in~$G$ that visits every vertex exactly once.
\end{definition}

Although Hamiltonian cycles sound similar to Euler tours---one visits
every node once while the other visits every edge once---finding a
Hamiltonian cycle or a Hamiltonian path can be a lot harder than
finding an Euler tour or path.  No one has yet discovered a simple
characterization for when a graph has a Hamiltonian cycle.  In fact,
determining whether a graph has a Hamiltonian cycle is the same
category of problem as the SAT problem of Section~\ref{SAT_sec}: you
get a million dollars from the Clay Institute for finding an efficient
way to determine whether a graph has a Hamiltonian cycle---or for
proving that there is no procedure that works efficiently on all
graphs.

\subsection{The Traveling Salesperson Problem}

In many applications, there are numerical costs or weights associated
with the edges of the graph.  For example, suppose the nodes of a
graph represent buildings and edges represent connections between
them.  The cost of a connection may vary a lot from one pair of
buildings or towns to another.  Another example is where the nodes
represent cities, and the weight of an edge is the distance between
them: the weight of the Los~Angeles/New~York~City edge is much higher
than the weight of the NYC/Boston edge.

As if the problem of finding a Hamiltonian cycle is not hard enough,
in a weighted graph, we sometimes need to find a Hamiltonian cycle
with \emph{minimum possible sum} of the weights of its edges.  This is
the famous \emph{Traveling Salesperson Problem}.

For example, suppose you would like to visit every node in the graph
shown in Figure~\ref{fig:5AL} exactly once, finishing at the node where
you started.  Can you find a weight~15 cycle that does this?

\begin{figure}
\graphic{Fig_5AL}
\caption{Is there a Hamiltonian cycle with weight~15?}
\label{fig:5AL}
\end{figure}

\iffalse
Needless to say, if you can figure out a fast procedure that finds the
minimum cycle for the traveling salesperson, let us know so that we
can win a million dollars.
\fi

\begin{editingnotes}
\textcolor{red}{Maybe include subsection on TSP within a small factor
  of minimal when distances are Euclidean?  This may already be in an
  old problem (not yet in repository).}
\end{editingnotes}

\section{$k$-connected Graphs}

If we think of a graph as modeling cables in a telephone network, or
oil pipelines, or electrical power lines, then we not only want
connectivity, but we want connectivity that survives component
failure.  One measure of connection strength is how many links must
fail before connectedness fails.  In particular, two vertices are
\term{$k$-edge connected} when it takes at least $k$ ``edge-failures''
to disconnect them.  More precisely:

\begin{definition}\label{def:k-connected}
Two vertices in a graph are $k$-\term{edge connected} when they remain
connected in every subgraph obtained by deleting up to $k-1$ edges.  A
graph with two or more vertices is $k$-edge
\index{connected!edge}\index{connected!$k$-edge}connected when every
pair of distinct vertices in the graph are $k$-edge connected.
\end{definition}
\iffalse
every two of its vertices are $k$-edge connected.
\fi

From now on we'll drop the ``edge'' modifier and just say
``$k$-\idx{connected}.''\footnote{There is a corresponding definition
  of $k$-\idx{vertex connected}ness\index{connected!$k$-vertex} based on
  deleting vertices rather than edges.  Graph theory texts usually use
  ``$k$-connected'' as shorthand for ``$k$-vertex connected.''  But
  edge-connectedness will be enough for us.}

For example, in the graph in figure~\ref{dg}, vertices $c$ and~$e$ are
3-connected, $b$ and~$e$ are 2-connected, $g$ and $e$ are 1 connected,
and no vertices are 4-connected.  The graph as a whole is only
1-connected.  A complete graph $K_n$ is $(n-1)$-connected.  Every
cycle is 2-connected.

Notice that two vertices are 1-connected iff they are connected
according to Definition~\ref{def:connected-vertices}.

The idea of a \emph{cut edge} is a useful way to explain 2-connectivity.
\begin{definition}
If two vertices are connected in a graph $G$, but not connected when
an edge $e$ is removed, then $e$ is called a \term{cut edge} of $G$.
\end{definition}
So a graph with more than one vertex is 2-connected iff it is
connected and has no cut edges.  The following Lemma is
another immediate consequence of the definition:
\begin{lemma}\label{lem:cutiffcycle}
An edge is a cut edge iff it is not on a cycle.
\end{lemma}
More generally, if two vertices are connected by $k$ edge-disjoint
paths---that is, no edge occurs in two paths---then they must
be $k$-connected, since at least one edge will have to be removed from
each of the paths before they could disconnect.  A fundamental fact,
whose ingenious proof we omit, is \idx{Menger}'s theorem which
confirms that the converse is also true: if two vertices are
$k$-connected, then there are $k$ edge-disjoint paths connecting them.
It takes some ingenuity to prove this just for the case $k=2$.

\subsection{The Minimum Number of Edges in a Connected Graph}

The following theorem says that a graph with few edges must have many
connected components.
\begin{theorem}\label{th:connectivity}
Every graph $G$ has at least $\card{\vertices{G}} - \card{\edges{G}}$
connected components.
\end{theorem}
Of course for Theorem~\ref{th:connectivity} to be of any use, there must
be fewer edges than vertices.

\begin{proof}
We use induction on the number $k$ of edges.  Let $P(k)$ be the
proposition that
\begin{quote}
every graph $G$ with $k$ edges has at least $\card{\vertices{G}}-k$
connected components.
\end{quote}

\inductioncase{Base case} ($k=0$): In a graph with 0 edges, each
vertex is itself a connected component, and so there are exactly
$\card{\vertices{G}} = \card{\vertices{G}} - 0$ connected components.
So $P(0)$ holds.

\inductioncase{Inductive step}:

\iffalse
Now we assume that the induction hypothesis holds for every $k$-edge
graph in order to prove that it holds for every $(k+1)$-edge graph,
where $k \geq 0$.
\fi

Let $G_e$ be the graph that results from removing an edge, $e \in
\edges{G}$.  So $G_e$ has $k$ edges, and by the induction hypothesis
$P(k)$, we may assume that $G_e$ has at least $(\card{\vertices{G}} -
k)$ connected components.  Now add back the edge $e$ to obtain the
original graph $G$.  If the endpoints of $e$ were in the same
connected component of $G_e$, then $G$ has the same sets of connected
vertices as $G_e$, so $G$ has at least $(\card{\vertices{G}} - k) >
(\card{\vertices{G}} - (k+1))$ components.  Alternatively, if the
endpoints of $e$ were in different connected components of $G_e$, then
these two components are merged into one component in~$G$, while all
other components remain unchanged, so that $G$ has one fewer connected
component than $G_e$.  That is, $G$ has at least $(\card{\vertices{G}}
- k) - 1 = (\card{\vertices{G}} - (k+1))$ connected components.  So in
either case, $G$ has at least $\card{\vertices{G}} - (k+1)$
components, as claimed.

This completes the inductive step and hence the entire proof by
induction.
\end{proof}

\begin{corollary}
\label{cor:n-1}
Every connected graph with $n$ vertices has at least $n - 1$ edges.
\end{corollary}

A couple of points about the proof of Theorem~\ref{th:connectivity}
are worth noticing.  First, we used induction on the number of edges
in the graph.  This is very common in proofs involving graphs, as is
induction on the number of vertices.  When you're presented with a
graph problem, these two approaches should be among the first you
consider.

The second point is more subtle.  Notice that in the inductive step,
we took an arbitrary $(k+1)$-edge graph, threw out an edge so that we
could apply the induction assumption, and then put the edge back.
You'll see this shrink-down, grow-back process very often in the
inductive steps of proofs related to graphs.  This might seem like
needless effort: why not start with an $k$-edge graph and add one more
to get an $(k+1)$-edge graph?  That would work fine in this case, but
opens the door to a nasty logical error called \term{buildup error},
illustrated in Problem~\ref{CP_bogus_pos_deg_but_not_connected}.

\iffalse

\subsubsection{Build-Up Error}

\begin{falseclm*}
If every vertex in a graph has degree at least~1, then the graph is
connected.
\end{falseclm*}

There are many counterexamples; for example, see Figure~\ref{fig:5Z}.

\begin{figure}

\graphic{Fig_5Z}

\caption{A counterexample graph to the False Claim.}

\label{fig:5Z}
\end{figure}

\begin{bogusproof}
We use induction.  Let $P(n)$ be the proposition that if every vertex
in an $n$-vertex graph has degree at least~1, then the graph is
connected.

\inductioncase{Base case} ($n=1$): There is only one graph with a
single vertex and it has degree~0.  Therefore, $P(1)$ is vacuously true,
since the if-part is false.

\inductioncase{Inductive step}: We must show that $P(n)$ implies
$P(n+1)$ for all $n \ge 1$.  Consider an $n$-vertex graph in which
every vertex has degree at least~1.  By the assumption~$P(n)$, this
graph is connected; that is, there is a path between every pair of
vertices.  Now we add one more vertex~$x$ to obtain an $(n+1)$-vertex
graph as shown in Figure~\ref{fig:5Y}.

\begin{figure}

\graphic{false-connect-pic}

\caption{Adding a vertex~$x$ with degree at least~1 to a connected
  $n$-node graph.}

\label{fig:5Y}

\end{figure}

All that remains is to check that there is a path from $x$ to every
other vertex~$z$.  Since $x$ has degree at least one, there is an edge
from~$x$ to some other vertex; call it~$y$.  Thus, we can obtain a
path from~$x$ to~$z$ by adjoining the edge $\edge{x}{y}$ to the path
from~$y$ to~$z$.  This proves $P(n + 1)$.

By the principle of induction, $P(n)$ is true for all  $n \ge 1$,
which proves the theorem
\end{bogusproof}

Uh-oh\dots this proof looks fine!  Where is the bug?  It turns out
that the faulty assumption underlying this argument is that
\emph{every $(n + 1)$-vertex graph with minimum degree~1 can be
obtained from an $n$-vertex graph with minimum degree~1 by adding 1
more vertex}.  Instead of starting by considering an arbitrary $(n +
1)$-node graph, this proof only considered $(n + 1)$-node graphs
that you can make by starting with an $n$-node graph with minimum
degree~1.

The counterexample in Figure~\ref{fig:5Z} shows that this assumption
is false; there is no way to build the 4-vertex graph in
Figure~\ref{fig:5Z} from a 3-vertex graph with minimum degree~1.
Thus the first error in the proof is the statement ``This proves
$P(n + 1)$.''

This kind of flaw is known as ``build-up error.''  Usually, build-up
error arises from a faulty assumption that every size $n + 1$ graph
with some property can be ``built up'' from a size~$n$ graph with the
same property.  (This assumption is correct for some properties, but
incorrect for others---such as the one in the argument above.)

One way to avoid an accidental build-up error is to use a ``shrink
down, grow back'' process in the inductive step, namely, start with a
size $n+1$ graph, remove a vertex (or edge), apply the inductive
hypothesis $P(n)$ to the smaller graph, and then add back the vertex
(or edge) and argue that $P(n + 1)$ holds.  Let's see what would have
happened if we'd tried to prove the claim above by this method:

\inductioncase{Revised inductive step}: We must show that $P(n)$
implies $P(n + 1)$ for all $n \ge 1$.  Consider an $(n + 1)$-vertex
graph~$G$ in which every vertex has degree at least~1.  Remove an
arbitrary vertex~$v$, leaving an $n$-vertex graph~$G_e$ in which every
vertex has degree\dots\ uh oh!

The reduced graph~$G_e$ might contain a vertex of degree~0, making the
inductive hypothesis $P(n)$ inapplicable!  We are stuck---and
properly so, since the claim is false!

Always use shrink-down, grow-back arguments and you'll never fall into
this trap.

%S08, cp6m, S06 cp5f

%S06 cp5f
\fi

%% Connectedness Problems %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{problems}
\classproblems
\pinput{CP_remove_connected}
\pinput{CP_n_dim_hypercube}
\pinput{CP_graph_maximal_connected}
\pinput{CP_Kn_is_very_connected}
\pinput{CP_bogus_pos_deg_but_not_connected}

\homeworkproblems
\pinput{PS_tangled_and_mangled_graphs}
\pinput{PS_circuit_graph_with_crossbars}
\pinput{PS_Euler_circuits}

\examproblems
\pinput{MQ_graph_state_machine}
\pinput{FP_cycles_components_induction}
\end{problems}

\section{Forests \& Trees}\label{trees-sec}

We've already made good use of acyclic digraphs, but acyclic
\emph{simple} graphs are arguably the most important graphs in
computer science.

\begin{definition}\label{def:tree}
An acyclic graph is called a \emph{forest}.  A connected acyclic graph
is called a \emph{tree}.
%\begin{definition}\label{def:forest}
\end{definition}

The graph shown in Figure~\ref{fig:5I} is a forest.  Each of its
connected components is by definition a tree.

\begin{figure}
\graphic{Fig_5I}
\caption{A 6-node forest consisting of 2 component trees.}
\label{fig:5I}
\end{figure}

\iffalse
As we have just seen, finding good cycles in a graph can be trickier than
you might first think.  But what if a graph has no cycles at all?  Sounds
pretty dull.
  But graphs without cycles, called \emph{acyclic graphs}, are
probably the most important graphs of all when it comes to computer
science.\fi

\subsection{Leaves, Parents \& Children}

One of the first things you will notice about trees is that they tend
to have a lot of nodes with degree one.  
\begin{definition}
A degree~1 node in a forest is called a \term{leaf}.
\end{definition}

The forest in Figure~\ref{fig:5I} has 4 leaves.  The tree in
Figure~\ref{fig:5H} has 5 leaves.

\begin{figure}
\graphic{tree-example}
\caption{A 9-node tree with 5 leaves.}
\label{fig:5H}
\end{figure}

\subsection{Tree Properties}

Trees have many unique properties.  We have listed some of them in the
following theorem.

\begin{theorem}\label{th:treeprops}
Every tree has the following properties:

\begin{enumerate}
\item Every connected subgraph is a tree.\label{treeprops:asub}

\item There is a unique path between every pair of
  vertices.\label{treeprops:uniquepath}

\item Adding an edge between any two nonadjacent nodes in a tree creates a
  graph with a cycle.

\item Removing any edge disconnects the graph.  That is, every edge is
  a cut edge.

\item If the tree has at least two vertices, then it has at least two
  leaves.

\item\label{treeprops:v=e+1} The number of vertices in a tree is one
  larger than the number of edges.
\end{enumerate}

\end{theorem}

\begin{editingnotes}
It would be more interesting and useful for spanning tree proofs below
to separate the implications from the equivalences, and include the
equivalence of Lemma~\ref{lem:iffe=v-1}.  The equivalences are
another chance to use the cycle-of-implications proof organization.
\end{editingnotes}

\begin{proof}

\begin{enumerate}

\item A cycle in a subgraph is also a cycle in the whole graph, so any
  subgraph of an acyclic graph must also be acyclic.  If the subgraph
  is also connected, then by definition, it is a tree.

\item Since a tree is connected, there is at least one path between
  every pair of vertices.  Suppose for the purposes of contradiction,
  that there are two different paths between some pair of vertices.
  Then there are two distinct paths $\walkv{p} \neq \walkv{q}$ between
  the same two vertices with minimum total length $\lnth{\walkv{p}}+
  \lnth{\walkv{q}}$.  If these paths shared a vertex $w$
  other than at the start and end of the paths, then the parts of
  $\walkv{p}$ and $\walkv{q}$ from start to $w$, or the parts of
  $\walkv{p}$ and $\walkv{q}$ from $w$ to the end, must be
    distinct paths between the same vertices with total length less than
   $\lnth{\walkv{p}}+ \lnth{\walkv{q}}$, contradicting the minimality
    of this sum.  Therefore,  $\walkv{p}$ and $\walkv{q}$ have no
        vertices in common besides their endpoints, and so
        $\merge{\walkv{p}}{\text{reverse}(\walkv{q})}$ is a cycle.

\iffalse
  Beginning at $u$, let $x$ be the first vertex where
  the paths diverge, and let $y$ be the next vertex they share.  (For
  example, see Figure~\ref{fig:5L}.)  Then there are two paths from
  $x$ to~$y$ with no common edges, which defines a cycle.  This is a
  contradiction, since trees are acyclic.  Therefore, there is
  exactly one path between every pair of vertices.
\begin{figure}
\graphic{unique-path}
\caption{If there are two paths between $u$ and~$v$, the graph must
  contain a cycle.}
\label{fig:5L}
\end{figure}
\fi

\item An additional edge $\edge{u}{v}$ together with the unique path
  between $u$ and $v$ forms a cycle.

\item Suppose that we remove edge $\edge{u}{v}$.  Since the tree
  contained a unique path between $u$ and $v$, that path must have
  been $\edge{u}{v}$.  Therefore, when that edge is removed, no path
  remains, and so the graph is not connected.

\item
  Since the tree has at least two vertices, the longest path in the
  tree will have different endpoints $u$ and $v$.  We claim $u$ is a
  leaf.  This follows because, by definition of endpoint, $u$ is
  incident to at most one edge on the path.  Also, if $u$ was incident to
  an edge not on the path, then the path could be lengthened by adding
  that edge, contradicting the fact that the path was as long as
  possible.  It follows that $u$ is incident only to a single edge,
  that is $u$ is a leaf.  The same hold for $v$.

\item We use induction on the proposition
\[
P(n) \eqdef \text{there are $n - 1$ edges in any $n$-vertex tree}.
\]

\inductioncase{Base case} ($n = 1$): $P(1)$ is true since a tree with
1 node has 0 edges and $1 - 1 = 0$.

\inductioncase{Inductive step}: Now suppose that $P(n)$ is true and
consider an $(n+1)$-vertex tree $T$.  Let $v$ be a leaf of the tree.
You can verify that deleting a vertex of degree 1 (and its incident
edge) from any connected graph leaves a connected subgraph.  So by
Theorem~\ref{th:treeprops}.\ref{treeprops:asub}, deleting $v$ and its
incident edge gives a smaller tree, and this smaller tree has $n - 1$
edges by induction.  If we re-attach the vertex $v$ and its incident
edge, we find that $T$ has $n = (n + 1) - 1$ edges.  Hence, $P(n + 1)$
is true, and the induction proof is complete.  \qedhere

\end{enumerate}

\end{proof}

Various subsets of properties in Theorem~\ref{th:treeprops} provide
alternative characterizations of trees.  For example,

\begin{lemma}\label{lem:iffe=v-1}
A graph $G$ is a tree iff $G$ is a forest and $\card{\vertices{G}} =
\card{\edges{G}} +1$.
\end{lemma}

The proof is an easy consequence of
Theorem~\ref{th:treeprops}.\ref{treeprops:v=e+1}, see
Problem~\ref{TP_forest_edges}.

\subsection{Spanning Trees}\label{spantree_subsec}
Trees are everywhere.  In fact, every connected graph contains a
subgraph that is a tree with the same vertices as the graph.  This is
called a \term{spanning tree} for the graph.  For example,
Figure~\ref{fig:5LL} is a connected graph with a spanning tree
highlighted.

\begin{figure}
\graphic{spanning-tree}
\caption{A graph where the edges of a spanning tree have been
  thickened.}
\label{fig:5LL}
\end{figure}

\begin{definition}
A \term{spanning subgraph} of a graph $G$ is a subgraph whose vertices
are the same as the vertices of $G$.
\end{definition}

\begin{theorem}\label{th:spantree}
Every connected graph contains a spanning tree.
\end{theorem}

\begin{proof}
Suppose~$G$ is a connected graph, so the graph $G$ itself is a
connected, spanning subgraph.  So by WOP, $G$ must have a minimum-edge
connected, spanning subgraph $T$.

We claim $T$ is a spanning tree.  Since $T$ is a connected, spanning
subgraph by definition, all we have to show is that $T$ is acyclic.
But suppose to the contrary that $T$ contained a cycle $C$.  By
Lemma~\ref{lem:cutiffcycle}, an edge $e$ of $C$ will not be a cut
edge, so removing it would leave a connected, spanning subgraph that
was smaller than $T$, contradicting the minimality to $T$.
\end{proof}

\subsection{Minimum-Weight Spanning Trees}\label{MST_subsec}

Spanning trees are particularly interesting and important for
\emph{weighted graphs}---graphs whose edges are assigned numerical
weights.  The overall \term{weight} of a weighted graph is the sum of
the weights of all its edges.  For example, the weight of the spanning
tree shown in Figure~\ref{fig:5KA}(a) is~19.
\begin{figure}
\subfloat[]{\graphic{Fig_5KA-a}}
\qquad
\subfloat[]{\graphic{Fig_5KA-b}}

\caption{A spanning tree (a) with weight 19 for a graph~(b).}
\label{fig:5KA}
\end{figure}

The general goal is to find a spanning tree with minimum weight,
called a \emph{minimum-weight spanning tree}
\textup(\term{MST}\textup).

\iffalse
\begin{definition}
A \term{minimum-weight spanning tree} (\textup\term{MST}\textup) of
an edge-weighted graph~$G$ is a spanning tree of~$G$ with the
smallest possible sum of edge weights.
\end{definition}
\fi

The spanning tree shown in Figure~\ref{fig:5KA}(a) turns out
\emph{not} to be an MST of the graph in Figure~\ref{fig:5KA}(b):
Figure~\ref{fig:5KB} shows another spanning tree for this graph with
weight~17.  This weight~17 turns out to be an MST, but how do we prove
it?  In general, how do we find an MST for a connected graph $G$?  We
could try enumerating all subtrees of $G$, but that approach would be
hopeless for large graphs.

\begin{figure}
\graphic{Fig_5KB}
\caption{An MST with weight~17 for the graph in
  Figure~\ref{fig:5KA}(b).}
\label{fig:5KB}
\end{figure}

\begin{editingnotes}
All new material replacing FTL's draft---ARM
\end{editingnotes}

For the rest of this section, suppose $G$ is a \emph{connected}
weighted graph.  We'll now explain a simple, general way to find an
MST of $G$.

\begin{definition}
A \term{black-white coloring}\index{coloring!black-white} of a simple
graph $G$ is a partition of the vertices $\vertices{G}$ into two
blocks---the ``black'' vertices and the ``white'' vertices.  A
\term{gray edge} of the coloring is an edge of $G$ with different
colored endpoints.
\end{definition}

\begin{lemma}\label{lem:enough-gray}
If $G$ is a connected graph, then every black-white coloring of $G$
contains a gray edge.
\end{lemma}

\begin{proof}
Any coloring of $G$ must have at least one vertex of each color---this
follows because the blocks of a partition are by definition nonempty.

Since $G$ is connected, there will be a path that begins at a black
vertex and ends at a white vertex.  Therefore at some point on the
path there has to be an edge that starts with a black vertex and ends
with a white one.  This is the gray edge.
\end{proof}

The weighted graphs examples up to now each had two or more edges with
the same weight.  This is common.  But our story becomes simpler if
all weights are different.

\begin{quote}
\emph{For the rest of this section, assume there are no same-weight
  edges: different edges have different weights}.
\end{quote}

There is really no loss of generality in assuming different weights,
since everything we do below assuming distinct weights would work if
we assigned an arbitrary rank to same-weight edges and treated higher
rank vertices as having larger weight.

The following lemma now makes it easy to find MST's.

\begin{lemma}[Gray Edge Lemma]\label{lem:necessary-gray}
For any black-white coloring of a connected graph $G$, the
minimum-weight edge among the gray edges of the coloring must be an
edge of \emph{every} MST of $G$.
\end{lemma}

So to find an MST for $G$, we just need to find enough minimum-weight
gray edges to form a spnning tree.  We do this using:

\begin{center}
{\large \emph{Minimum-Weight Gray Edge Procedure}}
\end{center}

\begin{quote}
Start off with the \emph{disconnected} spanning forest consisting of
the vertices of $G$ with all edges removed.  Next, suppose $S$ is a
spanning forest built up at some point by the procedure.  If $S$ is
not yet connected, then pick a black-white coloring of $G$ such that
such that all the vertices in the same connected component of $S$ have
the same color.  Update $S$ by adding the minimum weight gray edge of
this coloring to the edges of $S$.  Continue until $S$ becomes
connected.
\end{quote}

\begin{theorem}
The Minimum-Weight Gray Edge Procedure will terminate with an MST.
\end{theorem}

\begin{proof}
To see why this procedure works, suppose $G$ has $n$ vertices and let
$S$ be the current spanning forest at any point in the procedure.  If
$S$ is not connected, a black-white coloring is chosen so that the
endpoints of any edge of $S$ are the same color.  This ensures that no
gray edge is an edge of $S$.

By Lemma~\ref{lem:enough-gray}, there must be at least one gray edge
in the coloring, so there will be a minimum-weight gray
edge.\footnote{\dots by the Well Ordering Principle for finite sets
  Lemma\ref{finite-WOP}.}  Updating $S$ by adding this gray edge
decreases the number of connected components of $S$ by one, so after
adding $n-1$ gray edges, the procedure will terminate with a connected
spanning forest, that is, a spanning \emph{tree} $T$.

By the Gray Edge Lemma~\ref{lem:necessary-gray}, every edge of $T$ has
to be in every MST of $G$.  This is only possible if all MST's have
the same edges as $T$, that is, they all equal $T$.  So $T$ is the
unique possible MST of $G$.
\end{proof}

\begin{corollary}\label{cor:uniqMST}
Every connected graph with no same-weight edges has a unique MST.
\end{corollary}

Here are three known algorithms that are special cases of the Minimum
Weight Gray Edge Procedure;

\begin{algorithm}\label{alg:MST1}[Prim]
  Grow $S$ one edge at a time by adding a minimum weight edge
  among the edges that have exactly one endpoint in $S$.
\end{algorithm}

This is the algorithm that comes from coloring the growing tree white
and all the vertices not in the tree black.  Then the gray edges are
the ones with exactly one endpoint in the tree.

\begin{algorithm}\label{alg:MST2}[Kruskal]
  Grow $S$ one edge at a time by adding a minimum weight edge among
  the edges that do not create a cycle in $S$.
\end{algorithm}

An edge does not create a cycle in $S$ iff it connects different
components of $S$.  So the edge chosen by Kruskal's algorithm will be
the minimum weight gray edge when the components it connects are
assigned different colors.

\begin{editingnotes}
For example, in the weighted graph we have been considering, we might
run Algorithm~\ref{alg:MST1} as follows.  Start by choosing one of the
weight~1 edges, since this is the smallest weight in the graph.
Suppose we chose the weight~1 edge on the bottom of the triangle of
weight~1 edges in our graph.  This edge is incident to the same vertex
as two weight~1 edges, a weight~4 edge, a weight~7 edge, and a
weight~3 edge.  We would then choose the incident edge of minimum
weight.  In this case, one of the two weight~1 edges.  At this point,
we cannot choose the third weight~1 edge: it won't be gray because its
endpoints are both in the tree, and so are both colored white.  But we
can continue by choosing a weight~2 edge.  We might end up with the
spanning tree shown in Figure~\ref{fig:5KC}, which has weight~17, the
smallest we've seen so far.

\begin{figure}
\graphic{Fig_5KC}
\caption{A spanning tree found by Algorithm~\ref{alg:MST1}.}
\label{fig:5KC}
\end{figure}

Now suppose we instead ran Algorithm~\ref{alg:MST2} on our graph.  We
might again choose the weight~1 edge on the bottom of the triangle of
weight~1 edges in our graph.  Now, instead of choosing one of the
weight~1 edges it touches, we might choose the weight~1 edge on the
top of the graph.  This edge still has minimum weight, and will be
gray if we simply color its endpoints differently, so
Algorithm~\ref{alg:MST2} can choose it.  We would then choose one of
the remaining weight~1 edges.  Note that neither causes us to form a
cycle.  Continuing the algorithm, we could end up with the same
spanning tree in Figure~\ref{fig:5KC}, though this will depend on
the tie breaking rules used to choose among gray edges with the same
minimum weight.  For example, if the weight of every edge in $G$ is
one, then all spanning trees are MST's with weight
$\card{\vertices{G}}-1$, and both of these algorithms can arrive at
each of these spanning trees by suitable tie-breaking.
\end{editingnotes}

\begin{editingnotes}
Verify that Prim \& Kruskal can create every MST when same-weights are allowed.
\end{editingnotes}

The coloring that explains Algorithm~\ref{alg:MST1} also justifies a more
flexible algorithm which has Algorithm~\ref{alg:MST1} as a special case:
\begin{algorithm}\label{alg:MST3}
  Grow a forest one edge at a time by picking any component and adding a
  minimum weight edge among the edges leaving that component.
\end{algorithm}
This algorithm allows components that are not too close to grow in
parallel and independently, which is great for ``distributed''
computation where separate processors share the work with limited
communication between processors.\footnote{The idea of growing trees
  in parallel seems first to have been developed in by Bor\.{u}vka
  (1926), ref TBA.  Efficient MST algorithms running in parallel time
  $O(\log \card{V})$ are described in Karger, Klein, and Tarjan
  (1995), ref TBA.}

Ok, to wrap up this story, all that's left is the proof of
Lemma~\ref{lem:necessary-gray} that min-weight gray edges must be in
every spanning tree.   Let's start with another lemma:

\begin{lemma}\label{lem;gray-swap}[Gray Edge Swap]
Let $G$ be a connected weighted graph, and let $e$ be the
minimum-weight gray edge of some black-white coloring of of $G$.
Suppose $C$ is a connected spanning subgraph of $G$, and $e$ is
\emph{not} an edge of $C$.  Then there is an edge $g$ of $C$ such that
\begin{itemize}
\item $\text{weight}(e) <  \text{weight}(g)$,

\item $C - g + e$ is connected, where $C - g + e$ is the graph
  obtained by removing $g$ and adding $e$ to the set of edges of $C$.
\end{itemize}
\end{lemma}

Notice that the Gray Edge Lemma~\ref{lem:necessary-gray} now follows
immediately from the Swap Lemma~\ref{lem;gray-swap}: if $C$ is a
spanning tree of $G$, then $C - g + e$ will also be a spanning tree,
and it has smaller weight.  So $C$ cannot be minimum-weight unless $e$
is one of its edges.

\begin{proof}(Swap Lemma~\ref{lem;gray-swap})
Pick a black-white coloring for which $e$ is a min-weight gray edge.
Since $C$ is a connected spanning graph, there is a path $\walkv{p}$
in $C$ between the different colored endpoints of $e$.  Now
$\walkv{p}$ has both a black endpoint and a white one, so it must
contain some gray edge $g \neq e$.  Since $e$ is a minimum weight gray
edge and there are no same-weight edges, we have
\[
\text{weight}(e) < \text{weight}(g).
\]

Next, notice that $\walkv{p} + e$ is a cycle.  So when $g$ is removed
from the cycle, the endpoints of $g$ remain connected by the rest of
the cycle.  This means $C+e-g$ is still a connected, spanning
subgraph, as required.
\end{proof}

\begin{staffnotes}
CLRS have lots of great exercises about all this.
\end{staffnotes}


%% Trees Problems %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{problems}
  \practiceproblems
  \pinput{TP_average_degree_of_tree_and_simple_path}
  \pinput{TP_disjoint_trees}
  \pinput{TP_forest_edges}
  \pinput{TP_hypercube_nocount}

  \examproblems
%  \pinput{FP_connected_induction} %unhide after S17 final
  \pinput{MQ_tree_plus_edge}
  \pinput{MQ_many_MSTs}
  \pinput{MQ_tree_diameter}
  \pinput{FP_graphs_short_answer}
  \pinput{FP_simple_graphs_TF}
  \pinput{FP_graph_width_one}
  \pinput{FP_tree_kcolor}
  \pinput{FP_MST_min_out_S16}
  \pinput{CP_maxweight_edge}

  \classproblems
  \pinput{CP_graph_edge_mark}
  \pinput{CP_spanning_tree_proc}
% \pinput{CP_tree_characterizations}
  \pinput{CP_min_weight_edge}
  \pinput{CP_build_MSTs}
  \pinput{CP_no_odd_length_cycles}
  %\pinput{CP_23_high_priority_servers}

  \homeworkproblems
  \pinput{PS_tree_degree_sequence}
  \pinput{PS_unique_MST}
\end{problems}

\section{References}
\cite{Bollobas98},      %Bollobas
\cite{Diestel2000},
\cite{GoodaireP2001},
\cite{Gusfield1989},
\cite{HartsfieldR2003}

\endinput
