\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{PS_mating_ritual_commutes}
  \pcomment{ARM 1/13/17}
\end{pcomments}

\pkeywords{
  mating_ritual
  state_machine
  transition
  commuting
  confluence
  unique_final
  termination
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
According to the day-by-day description of the Mating Ritual\inbook{
  of Section~\bref{mating_ritual_sec}}, at the end of each day,
  \emph{every} the man's list is updated to remove the name of the
  woman he who rejected him.  But it's easier, and more flexible,
  simply to let one women reject one suitor at a time.

In particular, the states of this Flexible Mating Ritual state machine
will be the same as for the day-by-day Ritual: a state will be a list,
for each man, of the women who have not rejected him.  But now a
transition will be to choose two men who are serenading the same
woman---that is, who have the same woman at the top of their current
lists---and then have the woman reject whichever of the two she likes
less.  So the only change in state is that the name of the serenaded
woman gets deleted from the top of the list of the man she liked less
among two of her serenaders---everything else stays the same.

It's a worthwhile review to verify that the same preserved invariants
used to establish the properties of the Mating Ritual will apply to
the Flexible Mating Ritual.  This ensures that the Flexible Ritual
will also terminate with a stable set of marriages.

But now a new issue arises: we know that there can be many sets of
possible sets of stable marriages for the same set of men/women
preferences.  So it seems possible that the Flexible Ritual might
terminate with different stable marriage sets, depending on which
choice of transition was made at each state.  But this does not
happen: the Flexible Ritual will always terminate with the same set of
stable marriages as the day-by-day Ritual.

To prove this, we begin with a definition: a state machine has
\emph{commuting transitions} if for any states $p,q,r$,
\[
(p \movesto q \ \QAND\ p \movesto r) \QIMPLIES \exists t.\, q \movesto t \ \QAND\ r \movesto t.
\]
\bparts

\ppart Verify that the Flexible Mating Ritual has commuting
transitions.

\begin{solution}
\TBA{Case analysis}.
\end{solution}

\ppart Now conclude from
Problem~\bref{PS_commuting_rewrite_confluence} that the Flexible
Mating Ritual always terminate with the same set of stable marriages
as the day-by-day Ritual.

\begin{solution}
Since the Flexible Ritual has commuting transitions, it is confluent
and therefore by Problem~\bref{PS_commuting_rewrite_confluence} has at
most one final state.  But since the Flexible Ritual can perform, in
sequence, the same set of rejections as the day-by-day Ritual, it can
reach the same final state as the day-by-day Ritual.  Hence this must
be the only final state reachable by the Flexible Ritual.
\end{solution}

\eparts 
\end{problem}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput
