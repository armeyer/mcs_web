\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{PS_Catalan_numbers_meyer_version}
  \pcomment{revised from S08.ps10 by ARM 11/20/09}
  \pcomment{revised 8/17/11 by ARM because earlier version
            assumed def of good-count that was commented out of recursive_data}
\end{pcomments}

\pkeywords{
  generating_functions
  Catalan
  Taylor_expansion
  Taylor_theorem
  Maclauren
  recursive
  bracket
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
  Generating functions provide an interesting way to count the number
  of strings of matched brackets.  To do this, we'll use a description
  of these strings as the set, $\GC$, of strings of brackets with a
  \idx{good count}.\footnote{Problem~\bref{PS_bracket_good_count} also
    examines these strings.)

  Namely, one precise way to determine if a string is matched is to
  start with 0 and read the string from left to right, adding 1 to the
  count for each left bracket and subtracting 1 from the count for
  each right bracket.  For example, here are the counts for the two
  strings above
\[\begin{array}{rrrrrrrrrrrrr}
& \lefbrk & \rhtbrk & \rhtbrk & \lefbrk & \lefbrk & \lefbrk & \lefbrk &
\lefbrk & \rhtbrk & \rhtbrk & \rhtbrk & \rhtbrk\\
0 & 1 & 0 & -1 & 0 & 1 & 2 & 3 & 4 & 3 & 2 & 1 & 0\\
\\
\\
& \lefbrk & \lefbrk & \lefbrk & \rhtbrk & \rhtbrk & \lefbrk & \rhtbrk &
\rhtbrk & \lefbrk & \rhtbrk\\
0 & 1 & 2 & 3 & 2 & 1 & 2 & 1 & 0 & 1 & 0
\end{array}\]
A string has a \term{good count} if its running count never goes
negative and ends with 0.  So the second string above has a good count, but
the first one does not because its count went negative at the third step.
\begin{definition*}
Let
\[
\GC \eqdef\  \set{ s \in \brkts \suchthat s\ \text{has a good count}}.
\]
\end{definition*}
The matched strings can now be characterized precisely as this set of
strings with good counts.

  Let $c_n$ be the number of strings in $\GC$ with exactly $n$ left
  brackets, and let $C(x)$ be the generating function for these
  numbers:
  \[
  C(x) \eqdef c_0 + c_1 x + c_2 x^2 + \cdots.
  \]

\bparts

\ppart\label{wrapdef} The \term{wrap} of a string, $s$, is the string,
$\lefbrk s\rhtbrk$, that starts with a left bracket followed by the
characters of $s$, and then ends with a right bracket.  Explain why
the generating function for the wraps of strings with a good count is
$xC(x)$.

\hint The wrap of a string with good count also has a good count that
starts and ends with 0 and remains \emph{positive} everywhere else.

\begin{solution}
  Having a good count by definition means the left-to-right bracket
  count starts and ends with 0 and never goes negative.  This means that
  the wrap of a string with good count also has a good count that starts
  and ends with 0 and remains \emph{positive} everywhere else.  Moreover,
  if a string has such a positive good count, then erasing its first and
  last brackets leaves a string with a good count.  In short, being the
  wrap of a string with a good count is the same as having a positive good
  count.

  This implies that wrapping is a bijection from strings with good counts
  to strings with positive good counts.  In particular, if $e_{n+1}$ is
  the number of strings with $n+1$ left brackets that have positive
  good counts, then $e_{n+1} = c_n$.  Therefore,
\begin{align*}
xC(x) & = 0+ c_0x +c_1x^2 +\cdots+ c_nx^{n+1} +\cdots\\
      & = e_0 + e_1x +e_2x^2 +\cdots+ e_{n+1}x^{n+1} +\cdots,
\end{align*}
which shows that $xC(x)$ is the generating function for the wraps of
strings with a good count.
\end{solution}

\ppart\label{unique-wrapped-parse} Explain why, for every string, $s$,
with a good count, there is a unique sequence of strings $s_1,\dots,s_k$
that are wraps of strings with good counts and $s = s_1\cdots s_k$.  For
example, the string $r \eqdef
\lefbrk\lefbrk\rhtbrk\rhtbrk\lefbrk\rhtbrk\lefbrk\lefbrk\rhtbrk\lefbrk\rhtbrk\rhtbrk
\in \GC$ equals $s_1s_2s_3$ where $s_1 \eqdef
\lefbrk\lefbrk\rhtbrk\rhtbrk, s_2 \eqdef \lefbrk\rhtbrk, s_3 \eqdef
\lefbrk\lefbrk\rhtbrk\lefbrk\rhtbrk\rhtbrk$, and this is the only way to
express $r$ as a sequence of wraps of strings with good counts.

\begin{solution}
  As explained in part~\eqref{wrapdef}, being the wrap of a string with a
  good count means being a string with a positive good count.  So $s_i$
  has to be the substring of $s$ that starts where the count is 0 for the
  $i$th time and ends when it is 0 for the $i+1$st time.
\end{solution}

\ppart Conclude that
\begin{equation}\label{1xcxc2}
C = 1 + xC + (xC)^2 + \cdots + (xC)^n + \cdots,
\end{equation}
so
\begin{equation}\label{C11-xC}
C = \frac{1}{1-xC}\, ,
\end{equation}
and hence
\begin{equation}\label{Cpmsqrt}
C= \frac{1 \pm \sqrt{1 -4x}}{2x}\, .
\end{equation}

\begin{solution}
  The Convolution Rule implies that $(xC)^k$ is the generating function
  for strings that are sequences of exactly $k$ strings with positive good
  counts.  So Equation~\eqref{1xcxc2} follows from
  part~\eqref{unique-wrapped-parse}.

  Then~\eqref{C11-xC} follows since the right hand side of~\eqref{1xcxc2}
  is a geometric series in $xC$.  Then~\eqref{Cpmsqrt} follows
  from~\eqref{C11-xC} using the quadratic formula.
\end{solution}

\eparts

Let $D(x) \eqdef 2xC(x)$.  Expressing $D$ as a power series
\[
D(x) = d_0 + d_1x +d_2 x^2 + \cdots,
\]
we have
\begin{equation}\label{cndn+1}
c_n  = \frac{d_{n+1}}{2}.
\end{equation}

\bparts

\ppart Use~\eqref{Cpmsqrt}, \eqref{cndn+1}, and the value of $c_0$ to conclude that
\[
D(x)= 1 - \sqrt{1 -4x}.
\]

\begin{solution}
  By~\eqref{Cpmsqrt}, $2xC(x) = 1 \pm \sqrt{1 -4x}$, so $D(x)$ is either
  $1 + \sqrt{1 -4x}$ or $1 - \sqrt{1 -4x}$.  Thus $D'(x)$ is either
  $\frac{-2}{\sqrt{1 -4x}}$ or $\frac{2}{\sqrt{1 -4x}}$.  It follows that
  \[
  d_1 = D'(0) = \begin{cases}
    -2 & \text{if } D(x) = 1 + \sqrt{1 -4x},\\
    2 & \text{if } D(x) = 1 - \sqrt{1 -4x}.
  \end{cases}
  \]

  But $c_0 = 1$ since $\lambda$ is the only string in $\GC$ with $0$ left
  brackets, and so $d_1 = 2$ by~\eqref{cndn+1}.  So the second case
  holds, namel $D(x)=1 - \sqrt{1 -4x}$.

\end{solution}

\ppart Prove that
\[
d_n = \frac{(2n-3) \cdot (2n-5) \cdots 5 \cdot 3 \cdot 1 \cdot 2^n}{n!}.
\]

\hint $d_n = D^{(n)}(0)/n!$

\begin{solution}
By Maclauren's theorem, the coefficient $d_n$ equals $D^{(n)}(0)/n!$.
Now,
\begin{align*}
D'(x)      & = 2 \cdot (1-4x)^{-\frac{1}{2}} \\
D''(x)     & = 1 \cdot 2^2 \cdot (1-4x)^{-\frac{3}{2}} \\
D'''(x)    & = 3 \cdot 1 \cdot 2^3 \cdot (1-4x)^{-\frac{5}{2}} \\
D^{(4)}(x) & = 5 \cdot 3 \cdot 1 \cdot 2^4 \cdot (1-4x)^{-\frac{7}{2}} \\
D^{(5)}(x) & = 7 \cdot 5 \cdot 3 \cdot 1 \cdot 2^5 \cdot (1-4x)^{-\frac{9}{2}} \\
\vdots \quad    &\qquad \vdots\\
D^{(n)}(x) & = (2n-3) \cdot (2n-5) \cdots 5 \cdot 3 \cdot 1 \cdot 2^n \cdot (1-4x)^{\frac{1-2n}{2}}
\end{align*}
Here the dots reflect a routine induction argument that we're omitting.

An alternative argument uses Newton's formula
\[
(1+x)^\alpha = \binom{\alpha}{0} + \binom{\alpha}{1}x + \binom{\alpha}{2}
x^2 + \cdots \binom{\alpha}{k}x^k + \cdots
\]
where
\[
\binom{\alpha}{k}  \eqdef \frac{\alpha (\alpha -1) (\alpha -2) \cdots
  (\alpha -k +1)}{k!}.
\]
\end{solution}

\ppart Conclude that
\[
c_n = \frac{1}{n+1} \binom{2n}{n}.
\]

\begin{solution}
Since $D(x)=2 x C(x)$,
\begin{align*}
c_n   & = \frac{1}{2} d_{n+1}\\
      & = (2n-1) \cdot (2n-3) \cdots 5 \cdot 3 \cdot 1 \cdot \frac{2^n}{(n+1)!}\\
      & = \frac{(n) \cdot (2n-1) \cdot (n-1) \cdot (2n-3) \cdot (n-2) \cdots 3 \cdot 1 \cdot 1}
               {(n) \cdot (n-1) \cdot (n-2) \cdots 1} \cdot
          \frac{2^n}{(n+1)!}\\
      & = \frac{2(n) \cdot (2n-1) \cdot 2(n-1) \cdot (2n-3) \cdot 2(n-2) \cdots 3 \cdot 2(1) \cdot 1}{n!} \cdot
          \frac{1}{(n+1)!}\\
      & = \frac{2n!}{n!(n+1)!} = \frac{2n!}{n!\,n!}\frac{1}{n+1}.
\end{align*}
\end{solution}

\eparts

\begin{editingnotes}
The method of partial fractions can only be applied to rational
functions (i.e. quotients of polynomials) and there are many
interesting generating functions that are not of this form.  Catalan
numbers come up frequently in counting the sizes of various
recursively defined sets---there are in fact hundreds of
interpretations of these
numbers!\footnote{\href{http://www-math.mit.edu/~rstan/ec/catadd.pdf}
  {http://www-math.mit.edu/~rstan/ec/catadd.pdf}}

The $n$th Catalan number, $c_n$, is equal to the number of strings in
$\GC$ having exactly $n$ left brackets.
\end{editingnotes}

\end{problem}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput
