\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{CP_RSA_proving_correctness}
  \pcomment{from: S09.cp8r}
\end{pcomments}

\pkeywords{
  number_theory
  modular_arithmetic
  primes
  RSA
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
  A critical fact about \idx{RSA} is, of course, that decrypting an encrypted
  message always gives back the original message!  That is, that
  $\rem{(m^{d})^e}{pq} =m$.  This will follow from something slightly more
  general:
\begin{lemma}\label{npdp}
Let $n$ be a product of distinct primes and $a \equiv 1 \pmod {\phi(n)}$
for some nonnegative integer, $a$.  Then
\begin{equation}\label{ma}
m^a \equiv m \pmod n.
\end{equation}
\end{lemma}

\bparts

\ppart Explain why Lemma~\ref{npdp} implies that $k$ and $k^5$ have the
same last digit.  For example:
%
\[
\underline{2}^5 = 3\underline{2}
\hspace{1in}
7\underline{9}^5 = 307705639\underline{9}
\]
\hint What is $\phi(10)$?

\begin{solution}
Two nonnegative integers have the same last digit iff they are
$\equiv \pmod {10}$.  Now $\phi(10) = \phi(2)\phi(5) = 4$ and $5 \equiv 1 \pmod 4$,
so by Lemma~\ref{npdp},
\[
k^5 \equiv k \pmod {10}.
\]
\end{solution}

\ppart Explain why Lemma~\ref{npdp} implies that the original message,
$m$, equals $\rem{(m^e)^d}{pq}$.

\begin{solution}
 To apply Lemma~\ref{npdp} to RSA, note that the first condition
  of the Lemma is that $n$ be a product of primes.  In RSA, $n=pq$ so this
  condition holds.

For $n=pq$, we have from from Lemma~\bref{phi_pq} or the more general
the Theorem~\bref{th:phi} that $\phi(n) = (p-1)(q-1)$.  So when $d$
and $e$ are chosen according to RSA, $de \equiv 1 \pmod {\phi(n)}$.
So $a \eqdef de$ satisfies the second condition of the Lemma.

Now, from equation~\eqref{ma} with $n=pq$ and $a=de$, we have
\[
(m^e)^d = m^{de} \equiv m \pmod {pq}.
\]
Hence,
\[
\rem{(m^e)^d}{pq} = \rem{m}{pq},
\]
but $\rem{m}{pq} = m$, since $0\leq m<pq$.
\end{solution}

\eparts

\bparts

\ppart\label{pma} Prove that if $p$ is prime, then
\begin{equation}\label{mp}
m^a \equiv m \pmod{p}
\end{equation}
for all nonnegative integers $a \equiv 1 \pmod {p-1}$.

\begin{solution}
If $p \divides m$, then equation~\eqref{mp} holds since both sides of the
congruence are $\equiv 0 \pmod p$.

So assume $p$ does not divide $m$.  Now if $a \equiv 1 \pmod {p-1}$,
then $a = 1 + (p-1)k$ for some $k$, so
\begin{align*}
m^a & = m^{1+ (p-1)k}\\
    & = m\cdot \paren{m^{p-1}}^k\\
    & \equiv m\cdot \paren{1}^k \pmod p
            & \text{(by Fermat's Little Thm.)}\\
    & \equiv m \pmod p.
\end{align*}
\end{solution}

\iffalse

\ppart\label{abk} Show that for any positive integers $j,k$,
if $a \equiv b \pmod k$ and $j \divides k$, then $a \equiv b \pmod j$

\begin{solution}

$a \equiv b \pmod k$ iff $k \divides (a-b)$.  But if $k \divides (a-b)$
and $j \divides k$, then also $j \divides (a-b)$, which implies $a \equiv
b \pmod j$.

\end{solution}
\fi

\ppart\label{abp} Prove that if $a \equiv b \pmod p_i$ for distinct
primes $p_1,p_2,\dots,p_n$, then $a \equiv b \pmod (p_1p_1\cdots
p_n)$.

\begin{solution}
By definition of congruence, $a \equiv b \pmod k$ iff $k \divides
(a-b)$.  So if $a \equiv b \pmod p_i$ for each $p_i$, then $p_i
\divides (a-b)$ for each $p_i$.  By the Unique Factorization
Theorem~\bref{}, the the product of the $p_i$'s must also divide
$(a-b)$, which means that $a \equiv b \pmod p_1p_1\cdots p_n$.
\end{solution}

\iffalse

\ppart\label{phip} Verify that for any $n>1$ and any prime divisor, $p$,
of $n$,
\[
\phi(p) \divides \phi(n).
\]

\begin{solution}
Let $p$ be a prime factor of $n$ and factor $n$ as $m\cdot p^k$
where $p$ does not divide $m$.  By the Euler function equations,
$\phi(n)=\phi(m)\phi(p^k)$, so $\phi(p^k) \divides \phi(n)$.  But
$\phi(p) = (p-1)$ which divides $(p-1)p^{k-1} = \phi(p^k)$.
\end{solution}
\fi


\ppart Combine the previous parts to complete the proof of
Lemma~\ref{npdp}.

\begin{solution}
Suppose $n$ is a product of distinct primes,
  $p_1p_2\cdots p_k$.  Then from the formulas for the Euler function,
  $\phi$, we have
\[
\phi(n) = (p_1 -1)(p_2 -1)\cdots (p_k-1).
\]

Now suppose $a \equiv 1 \pmod {\phi(n)}$, that is, $a$ is 1 plus a
multiple of $\phi(n)$, so it is also 1 plus a multiple of $p_i-1$.  That
is,
\[
a \equiv 1 \pmod {p_i-1}.
\]
Hence, by part~\eqref{pma},
\[
m^a \equiv m \pmod{p_i}
\]
for all $m$.  Since this holds for all factors, $p_i$, of $n$, we conclude
from part~\eqref{abp} that
\[
m^a \equiv m \pmod{n},
\]
which proves Lemma~\ref{npdp}.
\end{solution}

\eparts

\end{problem}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput
