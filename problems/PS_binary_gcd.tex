\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{PS_binary_gcd}
  \pcomment{By ARM 4/24/11 based on Shoup}
  \pcomment{soln edited ARM 3/16/13}
  \pcomment{lighter version in MQ_binary_gcd}
\end{pcomments}

\pkeywords{
  preserved_invariant
  GCD
  binary_GCD
  state_machine
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
  The \term{Binary GCD} state machine computes the GCD of integers $a
  > b > 0$ using only division by 2 and subtraction, which makes it
  run very efficiently on hardware that uses binary representation of
  numbers.  In practice, it runs more quickly than the more famous
  Euclidean algorithm described in Section~\bref{sec: Euclid}.

\begin{align*}
\text{states} & \eqdef \naturals^3\\
\text{start state} & \eqdef (a, b, 1)\\
\text{transitions} & \eqdef \text{ if } \min(x,y) > 0, \text{ then } (x,  y, e) \movesto\\
     &\qquad \text{the first possible state according to the rules:}\\
     &\qquad
       \begin{cases}
       (1, 0, ex)     & \text{(if $x = y$)}\\
       (1, 0, e)      & \text{(if $y=1$)},\\
       (x/2, y/2, 2e) & \text{(if $2 \divides x$ and $2 \divides y$)},\\
       (x/2, y, e)    & \text{(if $2 \divides x$)}\\
       (x, y/2, e)    & \text{(if $2 \divides y$)}\\
       (y, x, e)      & \text{(if $y>x$)}\\
       (x-y,y,e)      & \text{(otherwise)}.
       \end{cases}
\end{align*}

\bparts 

\ppart Use the Invariant Principle \iffalse
(Section~\bref{subsec:invariant})\fi to prove that if this machine
stops, that is, reaches a state $(x,y,e)$ in which no transition is
possible, then $e = \gcd(a,b)$.

\begin{solution}
We claim that a preserved invariant of this machine is
\[
\gcd(a,b) = e\gcd(x,y).
\]
To show this, we assume the invariant holds for state $(x,y,e)$ and
show that if $(x,y,e) \movesto (x',y',e')$, then $\gcd(a,b) =
e'\gcd(x',y')$.

The proof is by cases according to which kind of transition occurs.

\inductioncase{Case}: ($x=y$).  In this case, $(x',y',e') = (1,0,ex)$.
Now we have
\begin{align*}
\gcd(a,b) 
    & = e\gcd(x,x) 
          & \text{(by the invariant for $(x,x,e)$)}\\
    & = ex\\
    & = ex\gcd(1,0)
          & \text{(since $\gcd(1,0) = 1$)}\\
    & =  e'\gcd(x',y'),
\end{align*}
which shows that the invariant holds for $(x',y',e')$.

\inductioncase{Case}: ($2 \divides x$ and $2 \divides y$).  
In this case, $(x',y',e') = (x/2, y/2, 2e)$.

We use the easily verified fact
\begin{equation}\label{auavauv}
\gcd(au,av) = a\gcd(u,v).
\end{equation}

Now
\begin{align*}
\gcd(a,b)
  & =  e\gcd(x,y)
        & \text{(by the invariant for $(x,y,e)$)}\\
  & = e 2\gcd(x/2,y/2)
        & \text{(by~\eqref{auavauv})}\\
  & = e'\gcd(x',y'),
\end{align*}
which shows that the invariant holds for $(x',y',e')$.

\inductioncase{Case}: ($2 \divides x$ and 2 does not divide $y$).
In this case, $(x',y',e') = (x/2,y, e)$.

We use the easily verified fact
\begin{equation}\label{auvvuv}
\gcd(au,v) = \gcd(u,v)
\end{equation}
for $a$ relatively prime to $v$.

Now
\begin{align*}
\gcd(a,b)
  & = e\gcd(x,y)
      & \text{(invariant for $(x,y,e)$)}\\
  & = e\gcd(x/2,y)
      & \text{(by~\eqref{auvvuv})}\\
  & = e'\gcd(x',y'),
\end{align*}
which shows that the invariant holds for $(x',y',e')$.

\inductioncase{Case}: (otherwise clause).
In this case $(x',y',e') = (x-y,y,e)$.

We use the easily verified fact that
\begin{equation}\label{gcdu-v}
\gcd(u-v,v) = \gcd(u,v).
\end{equation}

Now,
\begin{align*}
\gcd(a,b)
  & = e\gcd(x,y) & \text{(invariant for $(x,y,e)$)}\\
  & = e\gcd(x-y,y) & \text{(by~\eqref{gcdu-v})}\\
  & = e'\gcd(x',y'),
\end{align*}
proving that the invariant holds for $(x',y',e')$.

Verification of the remaining cases follows similarly.

To apply the Invariant Principle, we now first observe that the
preserved invariant holds trivially in the start state $(a,b,1)$
because $\gcd(a,b) = 1\cdot\gcd(a,b)$.  We conclude that the preserved
invariant holds in every reachable state.

We claim that only the first two rules can lead to stopped states,
which in both cases are of the form $(1,0,e')$.  If such a state is
reachable, then the invariant implies
\[
\gcd(a,b) = e'\gcd(1,0) = e',
\]
as required.

To see why these are the only stopped states, note that The final
transition rule to state $(x-y,y,e)$ is only possible if $x>y>0$, so
another transition will be possible after applying this rule.  A
transition is also possible from the start state.  Moves by the third
through sixth rules do not lead to stopped states, since the minimum
of the new $x$ and $y$ values remains positive.
\end{solution}

\ppart Prove that the machine reaches a final state in at most
$1+3(\log a +\log b)$ transitions.  (This is a coarse bound; you may
be able to get a better one.)

%\hint Strong induction on $\max(a,b)$.

\begin{solution}
Either $x$ or $y$ gets halved after at most three transitions---the
worst case is when $x$ and $y$ are both odd and $y > x > 1$.  In that
case, the first transition switches $x$ and $y$, the next subtracts
one from the other yielding an even value of $x$, and the third
transition will halve $x$.  So after at most $3(\log a + \log b)$
transitions, one of $x$ and $y$ must have been reduced to 1, after
which there can be at most one more transition.
\end{solution}

\eparts

\end{problem}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput

