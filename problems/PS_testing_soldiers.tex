\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{PS_testing_soldiers}
  \pcomment{F95.ps11}
  \pcomment{from Feller, exercises on expectation}

  \pcomment{revised by ARM, 5/12/12 and 12/9/12}
\end{pcomments}

\pkeywords{
 probability
 random_variable
 expectation
 recurrence
 independent
 derivative
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem} (A true story from world war two).

The army needs to test $n$ soldiers for a disease.  There is a blood
test that accurately determines when a blood sample contains blood
from a diseased soldier.  The army presumes, based on experience, that
the fraction of soldiers with the disease is approximately equal to
some small number $p$.

Approach 1.\ is to test blood from each soldier individually; this
requires $n$ tests.  Approach 2./ is to randomly group the soldiers
into $g$ groups of $k$ soldiers, where $n = gk$.  For each group,
blend the $k$ blood samples of the people in the group, and test the
blended sample.  If the group-blend is free of the disease, we are
done with that group after one test.  If the group-blend tests
positive for the disease, then someone in the group has the disease,
and we to test all the people in the group for a total of $k+1$ tests
on that group.

Since the groups are chosen randomly, each soldier in the group has
the disease with probability $p$, and it is safe to assume that
whether one soldier has the disease is independent of whether the
others do.

\bparts

\ppart What is the expected number of tests in Approach 2.\ as a
function of the number of soldiers $n$, the disease fraction $p$, and
the group size $k$?  

\begin{solution}
Let $X_i$ be the random variable equal to the number of tests
performed on the $i$th random group of soldiers.  By independence, the
probability that no soldier in the group has the disease is $(1-p)^k$, so
$X_i$ takes value
$1$ with probability $(1-p)^k$ and value $k+1$ with probability
$1-(1-p)^k$.  Hence the expected number of tests is
\begin{align}
\Expect{\sum_{i=1}^g X_i}
   & = \sum_{i=1}^g \expect{X_i}\notag\\
   & = g\paren{(1-p)^k + (k+1)(1 - (1-p)^k)}\notag\\
   & = n\paren{\frac{k+1}{k} - (1-p)^k}.\label{EsXi}
\end{align}

\end{solution}

\ppart Show how to choose $k$ so that the expected number of tests
using Approach 2.\ is approximately $n\sqrt{p}$.  \hint Since $p$ is
small, you may assume that $(1-p)^k \approx 1$ and $\ln(1-p) \approx
-p$.

\begin{solution}
Choose $k$ to minimize~\eqref{EsXi}.  To do this, choose $k$ so that
the derivative wrt $k$ of~\eqref{EsXi}, namely,
\[
\frac{1}{k^2} + (1-p)^k \ln(1-p),
\]
equals 0.  Approximating $(1-p)^k$ by $1$ and $\ln(1-p)$ by $-p$, we
calculate that
\[
k \approx \frac{1}{\sqrt{p}}.
\]
Plugging this approximation for $k$ into~\eqref{EsXi} yields
\[
\expect{\text{\#tests with Approach 2}} \approx n\sqrt{p}.
\]
\end{solution}

\ppart What fraction of the work does Approach 2.\ expect to save over
Approach 1.\ in a million-strong army of whom approximately $1\%$ are
diseased?

\begin{solution}
If $p = 0.01$ then the fraction of work saved is
\[
\frac{1M - 1M(\sqrt{0.01})}{1M} = 0.9
\]
That is, Approach 2.\ saves $90\%$ of the testing that Approach
1.\ would require.

\end{solution}

\ppart Can you come up with a better scheme by using multiple levels
of grouping, that is, groups of groups?

\begin{solution}
There are many possible improvements.  Here is an Approach 3.\ blend
all the soldiers' blood and perform the test.  If it comes up negative
stop, else split the soldiers into two random groups and repeat on
each group.  If $E_n$ is the expected number of test with $n$
soldiers.  Under a similar independence assumption about soldiers in
the same group being diseased, we get
\[
E_n = (1-p)^n + (1- (1-p)^n)2E_{n/2}.
\]
This implies that $E_n = \Theta(pn)$ (see
Chapter~\bref{chap:recurrences} for an explanation of such
recurrences).  Since, in an expected sense, there will $pn$ soldiers
with the disease, and the number of soldiers with the disease is a
lower bound on the number of tests, this approach is optimal up to
constant factors.
\end{solution}

\eparts

\end{problem}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput
